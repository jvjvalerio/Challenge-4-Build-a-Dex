{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst penpal_1 = __importDefault(require(\"penpal\"));\n\nconst eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\n\nconst is_buffer_1 = __importDefault(require(\"is-buffer\"));\n\nconst version_1 = __importDefault(require(\"./version\"));\n\nconst AuthereumProvider_1 = __importDefault(require(\"./AuthereumProvider\"));\n\nconst StarkWareProvider_1 = __importDefault(require(\"./StarkWareProvider\"));\n\nconst ZkSyncProvider_1 = __importDefault(require(\"./ZkSyncProvider\"));\n\nconst config_1 = require(\"./config\");\n\nconst utils_1 = require(\"./utils\"); // Serialize object for postMessage to iframe.\n// Converts references to values.\n\n\nconst serializeMessageObj = obj => {\n  const tx = {};\n\n  for (let k in obj) {\n    let v = obj[k];\n\n    if (typeof v === 'object' && v.toString === 'function') {\n      v = v.toString('hex');\n    }\n\n    tx[k] = v;\n  }\n\n  return tx;\n};\n\nconst defaultIframeStyle = {\n  width: 0,\n  height: 0,\n  top: 0,\n  left: 0,\n  zIndex: 1\n};\n\nconst noop = () => {// noop\n}; // This is a placeholder notify object stub until notifier script url is\n// injected into page after iframe is loaded.\n\n\nconst defaultNotifier = {\n  notify: (type, message) => {\n    console.debug(type, message);\n    return {\n      dismiss: noop\n    };\n  }\n};\n\nconst constructIframe = input => {\n  const {\n    id,\n    url,\n    isPreload,\n    disableGoogleAnalytics\n  } = input;\n  let parentUrl = window.location.href;\n\n  try {\n    parentUrl = parent.document.URL;\n  } catch (err) {// noop\n  }\n\n  const srcUrl = utils_1.updateQueryParams({\n    url: parentUrl,\n    isPreload,\n    disableGoogleAnalytics\n  }, url);\n  const iframe = document.createElement('iframe');\n  iframe.id = id;\n  iframe.name = id.replace(/--.*/, '');\n  iframe.title = id;\n  iframe.src = srcUrl;\n\n  if (['Safari', 'Firefox'].includes(utils_1.browserInfo().browser)) {\n    iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin');\n  }\n\n  iframe.style.position = 'fixed';\n  iframe.style.bottom = '0';\n  iframe.style.right = '0';\n  iframe.style.width = '0';\n  iframe.style.height = '0';\n  iframe.style.border = '0';\n  iframe.style.background = 'transparent';\n  iframe.style.zIndex = `${defaultIframeStyle.zIndex}`;\n  iframe.setAttribute('frameborder', '0');\n  iframe.setAttribute('scrolling', 'no');\n  return iframe;\n};\n\nconst onDomReady = () => {\n  return new Promise(resolve => {\n    if (typeof window !== 'undefined') {\n      if (document.readyState !== 'loading') {\n        resolve();\n      } else {\n        document.addEventListener('DOMContentLoaded', () => resolve());\n      }\n    }\n  });\n};\n\nclass Authereum extends eventemitter3_1.default {\n  constructor(config) {\n    super();\n    this._debug = !!utils_1.getQueryParamValue('debug');\n    this._notifier = defaultNotifier;\n    this._cacheReady = false;\n    this._iframeReady = false;\n    this._configReady = false;\n    this._iframeConnecting = null;\n    this._readyEmitted = false;\n    this._widgetEnabled = false;\n    this._iframeStyle = defaultIframeStyle;\n    this._notificationIframeStyle = defaultIframeStyle;\n    this._blockedPopupRedirect = true;\n    this._forceRedirect = false;\n    this._heartbeatStarted = false;\n    this._backoffTimeout = 1;\n    this._userConfig = null;\n    this._asymmetricEncryptionKey = null;\n    this._authereumQueryParams = {};\n    this._injectedElements = [];\n    this._notificationsMap = {};\n    this._destroyed = false;\n    this._starkProvider = null;\n    this._zkSyncProvider = null;\n    this._isPreload = false;\n    this._disableGoogleAnalytics = false;\n    this._eventListeners = []; // NOTE: keep this sync\n\n    this._init = config => {\n      this._initConfig(config);\n\n      this._iframeStyle = {\n        width: 0,\n        height: 0,\n        top: 0,\n        left: 0,\n        zIndex: 0\n      };\n      this._provider = new AuthereumProvider_1.default(this);\n\n      this._connectToChildIframe().catch(() => {\n        this._startHeartbeat(true);\n      }).catch(err => {\n        console.warn('ping error:', err.message);\n      });\n\n      this._setupCache().catch(noop);\n\n      this._cacheAuthereumQueryParams();\n\n      this._setupSigningKey().catch(noop);\n\n      this._setupResizeListener();\n\n      this._setupFocusListener();\n\n      this._setupActionKeyListener();\n\n      this._emitReadyEvent();\n    }; // NOTE: keep this sync\n\n\n    this._initConfig = config => {\n      if (typeof config === 'string') {\n        let network = config;\n        this._networkName = (network || '').trim().toLowerCase();\n\n        if (['mainnet', 'ropsten', 'rinkeby', 'kovan', 'goerli'].includes(this._networkName)) {\n          this._xsUri = config_1.defaultConfig.xsUri(this._networkName);\n        } else if (config === 'localhost') {\n          this._xsUri = 'http://localhost:3002';\n          this._networkName = 'kovan';\n        } else {\n          throw new Error('Unsupported network');\n        }\n      } else {\n        config = config || {};\n        this._networkName = config.networkName || 'mainnet';\n        this._xsUri = config.xsUri || config_1.defaultConfig.xsUri(this._networkName);\n        this._apiKey = config.apiKey;\n      }\n\n      if (config.redirectUri) {\n        this._redirectUri = config.redirectUri;\n      } else {\n        this._redirectUri = window.location.href;\n      }\n\n      this._redirectUri = this._redirectUri || window.location.href;\n    }; // NOTE: keep this sync\n\n\n    this._setConfig = config => {\n      if (typeof this._userConfig === 'string') {\n        let network = this._userConfig;\n        this._networkName = (network || '').trim().toLowerCase();\n        this._userConfig = {\n          networkName: this._networkName,\n          xsUri: config_1.defaultConfig.xsUri(this._networkName)\n        };\n      }\n\n      const {\n        apiKey,\n        apiUri,\n        rpcUri,\n        webUri,\n        notifierUri,\n        networkName,\n        networkId,\n        disableNotifications,\n        blockedPopupRedirect,\n        forceRedirect\n      } = this._userConfig || {};\n\n      if (apiKey) {\n        this._apiKey = apiKey;\n      } // userConfig overrides regular config\n\n\n      if (apiUri) {\n        this._apiUri = apiUri;\n      } else if (config.apiUri) {\n        this._apiUri = config.apiUri;\n      } // userConfig overrides regular config\n\n\n      if (rpcUri) {\n        this._rpcUri = rpcUri;\n      } else if (config.rpcUri) {\n        this._rpcUri = config.rpcUri;\n      } // userConfig overrides regular config\n\n\n      if (webUri) {\n        this._webUri = webUri;\n      } else if (config.webUri) {\n        this._webUri = config.webUri;\n      } // userConfig overrides regular config\n\n\n      if (notifierUri) {\n        this._notifierUri = notifierUri;\n      } else if (config.notifierUri) {\n        this._notifierUri = config.notifierUri;\n      } // userConfig overrides regular config\n\n\n      if (networkName) {\n        this._networkName = networkName;\n      } else if (config.networkName) {\n        this._networkName = config.networkName;\n      } // userConfig overrides regular config\n\n\n      if (networkId) {\n        this._networkId = networkId;\n      } else if (config.networkId) {\n        this._networkId = config.networkId;\n      } // userConfig overrides regular config\n\n\n      if (typeof disableNotifications === 'boolean') {\n        this._disableNotifications = disableNotifications;\n      } else if (typeof config.disableNotifications === 'boolean') {\n        this._disableNotifications = config.disableNotifications;\n      } // userConfig overrides regular config\n\n\n      if (typeof blockedPopupRedirect === 'boolean') {\n        this._blockedPopupRedirect = blockedPopupRedirect;\n      } else if (typeof config.blockedPopupRedirect === 'boolean') {\n        this._blockedPopupRedirect = config.blockedPopupRedirect;\n      } // userConfig overrides regular config\n\n\n      if (typeof forceRedirect === 'boolean') {\n        this._forceRedirect = forceRedirect;\n      } else if (typeof config.forceRedirect === 'boolean') {\n        this._forceRedirect = config.forceRedirect;\n      }\n    };\n\n    this._setupCache = () => __awaiter(this, void 0, void 0, function* () {\n      yield Promise.all([this._cacheLoginKeyAddress(), this._cacheIsAuthenticated(), this._cacheAccountAddress()]);\n      this._cacheReady = true;\n    });\n\n    this._handleWindowFocus = () => {\n      if (this._destroyed) {\n        return;\n      }\n\n      if (!this._bodyContainsIframe()) {\n        return;\n      }\n\n      return this._postMessageToChild({\n        method: 'onWindowFocus'\n      });\n    };\n\n    this._resetCache = () => __awaiter(this, void 0, void 0, function* () {\n      return this._setupCache();\n    });\n\n    this._injectScript = (sourceUrl, id = '') => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilDomReady();\n      return new Promise((resolve, reject) => {\n        if (!sourceUrl) {\n          throw new Error('sourceUrl is required');\n        }\n\n        if (document.getElementById(id)) {\n          resolve();\n          return;\n        }\n\n        const script = document.createElement('script');\n        script.id = id;\n        script.type = 'text/javascript';\n        script.async = true;\n\n        script.onload = () => {\n          resolve();\n        };\n\n        script.onerror = err => {\n          reject(err);\n        };\n\n        script.src = sourceUrl;\n\n        this._injectedElements.push(script);\n\n        document.getElementsByTagName('head')[0].appendChild(script);\n      });\n    });\n\n    this._setupResizeListener = () => __awaiter(this, void 0, void 0, function* () {\n      this.addEventListener('resize', this._handleResizeThrottled, false);\n      this.addEventListener('resize', this._handleResizeDebounced, false);\n    });\n\n    this._handleActionKeyPress = event => {\n      if (this._destroyed) {\n        return;\n      }\n\n      if (!this._bodyContainsIframe()) {\n        return;\n      }\n\n      let keyName = '';\n\n      if (event.key === 'Escape' || event.key === 'Esc' || event.keyCode === 27) {\n        keyName = 'escape';\n      } else if (event.key === 'Enter' || event.keyCode === 13) {\n        keyName = 'enter';\n      } else if (event.key === 'ArrowLeft' || event.keyCode === 37) {\n        keyName = 'left';\n      } else if (event.key === 'ArrowUp' || event.keyCode === 38) {\n        keyName = 'up';\n      } else if (event.key === 'ArrowRight' || event.keyCode === 39) {\n        keyName = 'right';\n      } else if (event.key === 'ArrowDown' || event.keyCode === 40) {\n        keyName = 'down';\n      }\n\n      if (keyName) {\n        return this._postMessageToChild({\n          method: 'actionKeyPress',\n          params: keyName\n        });\n      }\n    };\n\n    this._handleResize = event => __awaiter(this, void 0, void 0, function* () {\n      if (this._destroyed) {\n        return;\n      }\n\n      if (!this._bodyContainsIframe()) {\n        return;\n      }\n\n      const size = yield this._getWindowSize();\n      return this._postMessageToChild({\n        method: 'onResize',\n        params: size\n      });\n    });\n\n    this._handleResizeThrottled = utils_1.throttle(event => {\n      return this._handleResize(event);\n    }, 10);\n    this._handleResizeDebounced = utils_1.debounce(event => {\n      return this._handleResize(event);\n    }, 10);\n\n    this._cacheLoginKeyAddress = () => __awaiter(this, void 0, void 0, function* () {\n      const loginKey = yield this._postMessageToChild({\n        method: 'getOrCreateLoginKey'\n      });\n      this._cachedLoginKeyAddress = loginKey.publicAddress;\n    });\n\n    this._cacheAccountAddress = () => __awaiter(this, void 0, void 0, function* () {\n      const accountAddress = yield this._postMessageToChild({\n        method: 'getAccountAddress'\n      });\n      this._cachedAccountAddress = accountAddress;\n    });\n\n    this._cacheIsAuthenticated = () => __awaiter(this, void 0, void 0, function* () {\n      const isAuthenticated = yield this._postMessageToChild({\n        method: 'isAuthenticated'\n      });\n      this._cachedIsAuthenticated = isAuthenticated;\n    }); // NOTE: to prevent pop-ups from being blocked, there must be no awaits from\n    // click to window.open, meaning value lookups must be cached before the\n    // login method is called.\n\n\n    this.login = utils_1.throttle(() => __awaiter(this, void 0, void 0, function* () {\n      const isIframeReady = this._iframeReady && this._cacheReady;\n      const isConfigReady = this._configReady; // these are false when dapp calls login immediately on page load\n      // so we're forced to wait here.\n\n      if (!(isIframeReady && isConfigReady)) {\n        yield this._tilConfigReady();\n        yield this._tilReady();\n      }\n\n      if (!this._cachedIsAuthenticated) {\n        // NOTE: if not logged in to dapp, then proceed to login\n        yield this._signLoginKeyRequest(this._cachedLoginKeyAddress);\n        return this.getAuthenticatedAccount();\n      } else {\n        // only show one already logged in notification at a time\n        if (!this._notificationsMap['loggedIn']) {\n          this._postMessageToChild({\n            method: 'notification',\n            params: {\n              type: 'success',\n              message: 'You are logged into Authereum',\n              timeout: 5e3\n            }\n          }).catch(noop);\n\n          this._notificationsMap['loggedIn'] = true;\n          setTimeout(() => {\n            this._notificationsMap['loggedIn'] = null;\n          }, 5e3);\n        }\n      } // await first\n\n\n      const account = yield this.getAuthenticatedAccount();\n      return account;\n    }), 250);\n\n    this.authenticate = () => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.authenticate()` is deprecated. Use `authereum.login()` instead.');\n      return this.login();\n    });\n\n    this.isAuthenticated = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'isAuthenticated'\n      }));\n    });\n\n    this.logout = () => __awaiter(this, void 0, void 0, function* () {\n      const res = yield this._postMessageToChild({\n        method: 'logout'\n      });\n      yield this._resetCache();\n      this.emit('logout', {});\n      return res;\n    });\n\n    this.getAuthenticatedAccount = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getAuthenticatedAccount'\n      }));\n    });\n\n    this.getDappKey = () => {\n      return this._handleError(this._postMessageToChild({\n        method: 'getLoginKey'\n      }));\n    };\n\n    this.getLoginKey = () => {\n      console.warn('Deprecation notice: `authereum.getLoginKey()` is deprecated. Use `authereum.getDappKey()` instead.');\n      return this.getDappKey();\n    };\n\n    this.signMessage = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'signMessage',\n        params: [message, options]\n      }));\n    }), 250);\n    this.signPersonalMessage = utils_1.throttle(message => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'signMessage',\n        params: [message, {\n          personal: true\n        }]\n      }));\n    }), 250);\n    this.signWithDappKey = utils_1.throttle(message => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.signWithDappKey()` is deprecated. Use `authereum.signMess()` instead.');\n      return this.signMessage(message);\n    }), 250);\n    this.signWithLoginKey = utils_1.throttle(message => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.signWithLoginKey()` is deprecated. Use `authereum.signWithDappKey()` instead.');\n      return this.signWithDappKey(message);\n    }), 250);\n    this.signTypedMessage = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.signTypedMessage()` is deprecated. Use `authereum.signMessage()` instead.');\n      return this.signMessage(message, options);\n    }), 250);\n    this.signTypedMessageWithDappKey = utils_1.throttle(message => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.signTypedMessageWithDappKey()` is deprecated. Use `authereum.signMessage()` instead.');\n      return this.signTypedMessage(message);\n    }), 250);\n    this.signMessageWithAdminKey = utils_1.throttle(message => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.signMessageWithAdminKey()` is deprecated. Use `authereum.signMessageWithSigningKey()` instead.');\n      return null;\n    }), 250);\n    this.signMessageWithSigningKey = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'signMessageWithSigningKey',\n        params: [message, options]\n      }));\n    }), 250);\n\n    this.getSigningKeyAddress = message => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getSigningKeyAddress'\n      }));\n    });\n\n    this.getLoginKeyAuthSignature = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getLoginKeyAuthSignature'\n      }));\n    });\n\n    this.getLoginKeyRestrictionsData = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getLoginKeyRestrictionsData'\n      }));\n    });\n\n    this.getSigningKeyAuthSignature = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getSigningKeyAuthSignature'\n      }));\n    });\n\n    this.getAccountAddress = () => __awaiter(this, void 0, void 0, function* () {\n      // required so it waits for login key to be set\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'getAccountAddress'\n      }));\n    });\n\n    this.getBalance = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getBalance'\n      }));\n    });\n\n    this.getRpcUri = () => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilConfigReady();\n      return this._rpcUri;\n    });\n\n    this.getNetworkId = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getNetworkId'\n      }));\n    });\n\n    this.getNetworkName = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getNetworkName'\n      }));\n    });\n\n    this.getCachedNetworkName = () => {\n      return this._networkName;\n    };\n\n    this.getProvider = () => {\n      return this._provider;\n    };\n\n    this.getStarkProvider = () => {\n      if (!this._starkProvider) {\n        this._starkProvider = new StarkWareProvider_1.default(this);\n      }\n\n      return this._starkProvider;\n    };\n\n    this.getZkSyncProvider = () => {\n      if (!this._zkSyncProvider) {\n        this._zkSyncProvider = new ZkSyncProvider_1.default(this);\n      }\n\n      return this._zkSyncProvider;\n    };\n\n    this._handleError = promise => __awaiter(this, void 0, void 0, function* () {\n      return promise.catch(err => {\n        // NOTE: emit errors but don't throw notification here.\n        this.emit('error', err); // NOTE: rethrow error to let dapps handle error\n\n        throw err;\n      });\n    });\n\n    this.signTransaction = utils_1.throttle(tx => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'signTransaction',\n        params: serializeMessageObj(tx)\n      }));\n    }), 250);\n    this.signTransactionWithLoginKey = utils_1.throttle(tx => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum.signTransactionWithLoginKey()` is deprecated. Use `authereum.signTransaction()` instead.');\n      return this.signTransaction(tx);\n    }), 250);\n    this.sendTransaction = utils_1.throttle(userTransaction => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'sendTransaction',\n        params: serializeMessageObj(userTransaction)\n      }));\n    }), 250);\n    this.sendTransactionBatch = utils_1.throttle(userTransactions => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'sendTransactionBatch',\n        params: userTransactions.map(serializeMessageObj)\n      }));\n    }), 250);\n\n    this.estimateGas = userTransaction => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'estimateGasBatch',\n        params: serializeMessageObj(userTransaction)\n      }));\n    });\n\n    this.estimateGasBatch = userTransactions => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'estimateGasBatch',\n        params: userTransactions.map(serializeMessageObj)\n      }));\n    });\n\n    this.isReady = () => {\n      return this._iframeReady && this._cacheReady;\n    };\n\n    this.updateConfig = config => {\n      this._userConfig = config;\n\n      this._setConfig(config);\n    };\n\n    this.getConfig = () => {\n      return {\n        apiUri: this._apiUri,\n        rpcUri: this._rpcUri,\n        webUri: this._webUri,\n        xsUri: this._xsUri,\n        networkName: this._networkName,\n        networkId: this._networkId,\n        disableNotifications: this._disableNotifications\n      };\n    };\n\n    this.showWidget = (enabled = true) => __awaiter(this, void 0, void 0, function* () {\n      if (!enabled) {\n        this._widgetEnabled = false;\n        return this._postMessageToChild({\n          method: 'hideWidget'\n        });\n      }\n\n      this._widgetEnabled = true;\n      return this._postMessageToChild({\n        method: 'showWidget'\n      });\n    });\n\n    this.hideWidget = () => __awaiter(this, void 0, void 0, function* () {\n      this._widgetEnabled = false;\n      return this._postMessageToChild({\n        method: 'hideWidget'\n      });\n    });\n\n    this.widgetEnabled = () => {\n      return this._widgetEnabled;\n    };\n\n    this.addFunds = opts => {\n      return this._postMessageToChild({\n        method: 'addFunds',\n        params: opts\n      });\n    };\n\n    this._openUrl = (opts = {}) => {\n      const {\n        url,\n        newWindow\n      } = opts;\n\n      if (newWindow) {\n        window.open(url, '_blank');\n      } else {\n        window.location.href = url;\n      }\n    };\n\n    this._tilIframeReady = () => __awaiter(this, void 0, void 0, function* () {\n      if (!this._iframeReady) {\n        yield utils_1.wait(100);\n        return this._tilIframeReady();\n      }\n\n      yield utils_1.wait(100);\n      return true;\n    });\n\n    this._tilConfigReady = () => __awaiter(this, void 0, void 0, function* () {\n      if (!this._configReady) {\n        yield utils_1.wait(100);\n        return this._tilConfigReady();\n      }\n\n      yield utils_1.wait(100);\n      return true;\n    });\n\n    this._tilReady = () => __awaiter(this, void 0, void 0, function* () {\n      if (!this.isReady()) {\n        yield utils_1.wait(100);\n        return this._tilReady();\n      }\n\n      yield utils_1.wait(100);\n      return true;\n    });\n\n    this._emitReadyEvent = () => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      if (this._readyEmitted) return;\n      this._readyEmitted = true;\n      this.emit('ready', {});\n    });\n\n    this._connectToChildIframe = () => __awaiter(this, void 0, void 0, function* () {\n      if (this._iframeConnecting) {\n        return this._iframeConnecting;\n      }\n\n      this._iframeReady = false;\n      this._iframeConnecting = true;\n      const iframe = yield this._getOrCreateMainIframe();\n      this._iframeConnection = penpal_1.default.connectToChild({\n        iframe,\n        timeout: 60e3,\n        methods: {\n          // NOTE: the postMessage penpal method should be the only method that\n          // exists.\n          postMessage: data => {\n            return this._handlePostMessage(data);\n          }\n        }\n      });\n      this._iframeConnecting = new Promise((resolve, reject) => {\n        let timedout = false;\n        const timer = setTimeout(() => {\n          if (!this._iframeReady) {\n            timedout = true;\n            this._iframeConnecting = null;\n            reject(new Error('timedout'));\n          }\n        }, 6e3); // needs to be long enough for x-site to be fully loaded\n\n        this._iframeConnection.promise.then(child => {\n          clearTimeout(timer);\n\n          if (timedout) {\n            return;\n          }\n\n          this._iframeReady = true;\n          this._childIframeConnection = child;\n\n          this._startHeartbeat();\n\n          this._iframeConnecting = null;\n          resolve();\n        }).catch(err => {\n          clearTimeout(timer);\n\n          if (timedout) {\n            return;\n          }\n\n          reject(err);\n        });\n      });\n      return this._iframeConnecting;\n    });\n\n    this._startHeartbeat = (reconnect = false) => {\n      if (!this._heartbeatStarted) {\n        this._heartbeat(reconnect);\n\n        this._heartbeatStarted = true;\n      }\n    };\n\n    this._heartbeat = (reconnect = false) => __awaiter(this, void 0, void 0, function* () {\n      if (this._destroyed) {\n        return;\n      }\n\n      yield utils_1.wait(2e3);\n\n      try {\n        if (reconnect) {\n          yield this._connectToChildIframe();\n          this._backoffTimeout = 1;\n          return this._heartbeat();\n        }\n\n        yield this._ping();\n      } catch (err) {\n        // reconnect on destroyed connection error or ping timeout error\n        if (/destroy|timedout/gi.test(err.message)) {\n          yield utils_1.wait(this._backoffTimeout * 1e3); // exponential backoff\n\n          this._backoffTimeout = this._backoffTimeout << 1;\n          return this._heartbeat(true);\n        }\n      }\n\n      return this._heartbeat();\n    });\n\n    this._ping = () => __awaiter(this, void 0, void 0, function* () {\n      if (this._destroyed) {\n        console.warn('Authereum instance destroyed. Message not posted to child.');\n        return;\n      }\n\n      return new Promise((resolve, reject) => {\n        let timedout = false;\n        const timer = setTimeout(() => {\n          timedout = true;\n        }, 5e3);\n\n        this._postMessageToChild({\n          method: 'ping'\n        }).then(pong => {\n          clearTimeout(timer);\n\n          if (timedout) {\n            reject(new Error('timedout'));\n            return;\n          }\n\n          if (pong !== 'pong') {\n            reject(new Error('Invalid response'));\n            return;\n          }\n\n          resolve(pong);\n        }).catch(err => {\n          reject(err);\n        });\n      });\n    });\n\n    this._constructIframe = input => {\n      const iframe = constructIframe(Object.assign(Object.assign({}, input), {\n        isPreload: this._isPreload,\n        disableGoogleAnalytics: this._disableGoogleAnalytics\n      }));\n\n      if (this._debug) {\n        iframe.style.outline = '1px solid red';\n      }\n\n      this._injectedElements.push(iframe);\n\n      return iframe;\n    };\n\n    this._getConfigFromChild = () => __awaiter(this, void 0, void 0, function* () {\n      return this._postMessageToChild({\n        method: 'getConfig'\n      });\n    });\n\n    this._postVersionToChild = () => __awaiter(this, void 0, void 0, function* () {\n      return this._postMessageToChild({\n        method: 'version',\n        params: this.version()\n      });\n    });\n\n    this._postConfigToChild = () => __awaiter(this, void 0, void 0, function* () {\n      return this._postMessageToChild({\n        method: 'config',\n        params: {\n          apiKey: this._apiKey,\n          disableNotifications: this._disableNotifications\n        }\n      });\n    });\n\n    this._loadAsymmetricEncryptionKeyFromChild = () => __awaiter(this, void 0, void 0, function* () {\n      this._asymmetricEncryptionKey = yield this._postMessageToChild({\n        method: 'getAsymmetricEncryptionKey'\n      });\n    });\n\n    this._postMessageToChild = payload => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilIframeReady();\n\n      if (this._destroyed) {\n        throw new Error('Authereum instance destroyed.');\n      }\n\n      if (!this._bodyContainsIframe()) {\n        this._destroyed = true;\n\n        this._teardownEventListeners(); // ignore destroy call to already destroyed iframe\n\n\n        if (payload.method === 'destroy') {\n          return;\n        }\n\n        throw new Error('Authereum instance or iframe destroyed.');\n      }\n\n      return this._handleError(this._childIframeConnection.postMessage(payload));\n    });\n\n    this._handleChildLogoutEvent = () => __awaiter(this, void 0, void 0, function* () {\n      yield this._resetCache();\n      this.emit('logout', {});\n    });\n\n    this._handleChildDappKeyExpired = loginKeyAddress => __awaiter(this, void 0, void 0, function* () {\n      if (loginKeyAddress === this._cachedLoginKeyAddress) {\n        yield this._resetCache();\n        this.emit('dappKeyExpired', loginKeyAddress);\n        this.emit('logout');\n      }\n    });\n\n    this._handlePostMessage = data => {\n      try {\n        const {\n          method,\n          params\n        } = data;\n\n        switch (method) {\n          case 'onError':\n            const err = params;\n            this.emit('error', err);\n\n            this._notifier.notify({\n              type: 'error',\n              message: err.message\n            });\n\n            return;\n\n          case 'onLogout':\n            return this._handleChildLogoutEvent();\n\n          case 'onDappKeyExpired':\n            return this._handleChildDappKeyExpired(params);\n\n          case 'login':\n            return this.login();\n\n          case 'setWidgetPosition':\n            // const position = params\n            // const { x, y } = position\n            // this.iframeStyle.left = x\n            // this.iframeStyle.top = y\n            // this._refreshWidget()\n            return;\n\n          case 'setWidgetSize':\n            {\n              const size = params;\n              const {\n                width,\n                height\n              } = size;\n              this._iframeStyle.width = width;\n              this._iframeStyle.height = height;\n              return this._refreshWidget();\n            }\n\n          case 'setWidgetStyle':\n            {\n              const style = params;\n\n              for (let key in style) {\n                this._iframeStyle[key] = style[key];\n              }\n\n              return this._refreshWidget();\n            }\n\n          case 'setNotificationWidgetSize':\n            {\n              const size = params;\n              const {\n                width,\n                height\n              } = size;\n              this._notificationIframeStyle.width = width;\n              this._notificationIframeStyle.height = height;\n              return this._refreshNotificationWidget();\n            }\n\n          case 'setNotificationWidgetStyle':\n            {\n              const style = params;\n\n              for (let key in style) {\n                this._notificationIframeStyle[key] = style[key];\n              }\n\n              return this._refreshNotificationWidget();\n            }\n\n          case 'getWindowSize':\n            return this._getWindowSize();\n\n          case 'hideWidget':\n            return this.hideWidget();\n\n          case 'log':\n            return this._handlePostMessageLog(params);\n\n          case 'openUrl':\n            return this._openUrl(params);\n\n          default:\n            break;\n        }\n      } catch (err) {// noop\n      }\n    };\n\n    this._handlePostMessageLog = data => {\n      if (this._isPreload) {\n        return;\n      }\n\n      let {\n        type,\n        message\n      } = data;\n\n      if (!type) {\n        type = 'log';\n      }\n\n      console[type](message);\n    };\n\n    this._getWindowSize = () => {\n      return {\n        width: this._getWindowWidth(),\n        height: this._getWindowHeight()\n      };\n    };\n\n    this._getWindowWidth = () => {\n      return window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n    };\n\n    this._getWindowHeight = () => {\n      return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n    }; // public _setIframePositionTop = (y: number) => {\n    // if (!this._iframe) return\n    // this._iframe.style.top = `${y}px`\n    // }\n\n\n    this._setIframePositionLeft = x => {\n      if (!this._iframe) return;\n      this._iframe.style.left = `${x}px`;\n    };\n\n    this._setIframeWidth = width => {\n      if (!this._iframe) return;\n      this._iframe.style.width = `${width}px`;\n    };\n\n    this._setIframeHeight = height => {\n      if (!this._iframe) return;\n      this._iframe.style.height = `${height}px`;\n    };\n\n    this._refreshWidget = () => {\n      const {\n        top,\n        left,\n        width,\n        height,\n        zIndex\n      } = this._iframeStyle;\n      if (this._isPreload) return;\n      if (!this._iframe) return; // this._setIframePositionTop(top)\n      // this._setIframePositionLeft(left)\n\n      this._setIframeWidth(width);\n\n      this._setIframeHeight(height);\n\n      this._iframe.style.zIndex = `${zIndex || 0}`;\n    };\n\n    this._refreshNotificationWidget = () => {\n      const {\n        top,\n        left,\n        width,\n        height,\n        zIndex\n      } = this._notificationIframeStyle;\n      if (this._isPreload) return;\n      this._notificationIframe.style.width = `${width}px`;\n      this._notificationIframe.style.height = `${height}px`;\n      this._notificationIframe.style.zIndex = `${zIndex || 0}`;\n    };\n\n    this._loginKeyExists = () => __awaiter(this, void 0, void 0, function* () {\n      return !!(yield this.getLoginKey());\n    });\n\n    this._accountAddressExists = () => __awaiter(this, void 0, void 0, function* () {\n      return !!(yield this.getAccountAddress());\n    });\n\n    this._getAccountAdminKeyNonce = () => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'getAccountAuthKeyNonce'\n      }));\n    });\n\n    this._getAccountAuthKeyNonce = () => __awaiter(this, void 0, void 0, function* () {\n      console.warn('Deprecation notice: `authereum._getAccountAuthKeyNonce()` is deprecated. Use `authereum._getAccountAdminKeyNonce()` instead.');\n      return this._getAccountAdminKeyNonce();\n    });\n\n    this._executeLoginKeyMetaTx = tx => __awaiter(this, void 0, void 0, function* () {\n      return this._handleError(this._postMessageToChild({\n        method: 'executeLoginKeyMetaTx',\n        params: serializeMessageObj(tx)\n      }));\n    });\n\n    this._loadLoginKey = loginKey => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      return this._handleError(this._postMessageToChild({\n        method: 'loadLoginKey',\n        params: loginKey\n      }));\n    });\n\n    this._getAuthenticateUri = loginKeyAddress => {\n      const encryptionKey = this._asymmetricEncryptionKey;\n      const date = new Date();\n      date.setDate(date.getDate() + 30); // expire in 30 days\n\n      const expiresAt = date.getTime() / 1e3 | 0; // NOTE: slk = sign login key\n\n      return this._webUri + '/?slk=' + encodeURIComponent(JSON.stringify({\n        loginKey: {\n          publicAddress: loginKeyAddress,\n          expiresAt\n        },\n        encryptionKey\n      })) + '&redirect_uri=' + this._redirectUri;\n    };\n\n    this._getSignWithAdminKeyUri = message => {\n      if (is_buffer_1.default(message)) {\n        message = `0x${message.toString('hex')}`;\n      } // NOTE: sm = sign message\n\n\n      return this._webUri + '/?sm=' + encodeURIComponent(JSON.stringify({\n        message\n      })) + '&redirect_uri=' + this._redirectUri;\n    };\n\n    this._openPopupOrRedirect = url => __awaiter(this, void 0, void 0, function* () {\n      this.emit('openPopup', {});\n\n      if (this._forceRedirect) {\n        window.location.href = url;\n        return;\n      }\n\n      let child = this._getAuthereumPopupWindow(url);\n\n      let isBlocked = this._isAuthereumPopupBlocked(child);\n\n      if (isBlocked && !this._blockedPopupRedirect) {\n        const err = new Error('Disable popup blocker and try again');\n\n        this._notifier.notify({\n          type: 'error',\n          message: err.message,\n          timeout: 5000\n        });\n\n        throw err;\n      } else if (isBlocked) {\n        this.emit('popupBlocked');\n        const shouldShowPopupOrRedirect = yield this._showConfirmPopupOrRedirectModal();\n\n        if (!shouldShowPopupOrRedirect) {\n          const errMessage = 'Popup or redirect rejected';\n          this.emit('error', errMessage);\n          throw new Error(errMessage);\n        } // Try to bring up a user-initiated popup. If this fails\n        // fallback to a redirect\n\n\n        child = this._getAuthereumPopupWindow(url);\n        isBlocked = this._isAuthereumPopupBlocked(child);\n\n        if (isBlocked) {\n          window.location.href = url;\n          return;\n        }\n      }\n\n      child.focus();\n      return new Promise((resolve, reject) => {\n        const interval = setInterval(() => __awaiter(this, void 0, void 0, function* () {\n          if (child.closed) {\n            cleanUp();\n            const err = new Error('Window closed');\n            this.emit('error', err);\n            this.emit('closePopup', {});\n            reject(err);\n          }\n        }), 250);\n        const timeout = setTimeout(() => {\n          cleanUp();\n          child.close();\n          doneWithError(new Error('Timedout'));\n        }, 10 * 60 * 1000);\n\n        const cleanUp = () => {\n          clearInterval(interval);\n          clearTimeout(timeout);\n          this.emit('closePopup', {});\n        };\n\n        const doneWithError = err => {\n          cleanUp();\n          this.emit('error', err);\n          reject(err);\n        };\n\n        const done = (result = {}) => {\n          cleanUp();\n          resolve(result);\n        };\n\n        const handleParentMessageEvent = event => __awaiter(this, void 0, void 0, function* () {\n          if (event.origin.includes(this._webUri)) {\n            // this event tells parent to close child popup\n            if (event.data.close) {\n              child.close();\n              done();\n            }\n\n            if (event.data.login) {\n              done({\n                success: true\n              });\n              this.emit('login', {});\n              this._cachedIsAuthenticated = true;\n\n              if (event.data.encryptedSigningKey) {\n                yield this._loadSigningKey(event.data.encryptedSigningKey);\n              }\n\n              this._logAnalyticsEvent({\n                eventType: 'logged_in_dapp',\n                properties: {\n                  dapp_url: window.location.href\n                }\n              });\n\n              if (this._redirectUri !== window.location.href) {\n                window.location.href = this._redirectUri;\n              }\n            }\n\n            if (event.data.result) {\n              done(event.data.result);\n\n              if (this._redirectUri !== window.location.href) {\n                window.location.href = this._redirectUri;\n              }\n            }\n\n            if (event.data.error) {\n              doneWithError(new Error(event.data.error));\n\n              if (this._redirectUri !== window.location.href) {\n                window.location.href = this._redirectUri;\n              }\n            }\n          }\n        });\n\n        this.addEventListener('message', handleParentMessageEvent, false);\n      });\n    });\n\n    this.addEventListener = (type, listener, useCapture = false) => {\n      window.addEventListener(type, listener, useCapture);\n\n      this._eventListeners.push({\n        type,\n        listener,\n        useCapture\n      });\n    };\n\n    this._showConfirmPopupOrRedirectModal = () => {\n      return this._handleError(this._postMessageToChild({\n        method: 'showConfirmPopupOrRedirectModal'\n      }));\n    };\n\n    this._signLoginKeyRequest = publicAddress => __awaiter(this, void 0, void 0, function* () {\n      const url = this._getAuthenticateUri(publicAddress);\n\n      return this._openPopupOrRedirect(url);\n    });\n\n    this._tilDomReady = () => __awaiter(this, void 0, void 0, function* () {\n      return onDomReady();\n    }); // keep both static and normal version methods\n\n\n    this.version = () => {\n      return version_1.default;\n    };\n\n    this.isAuthenticatedSync = () => {\n      return this._cachedIsAuthenticated;\n    };\n\n    this.getTransactionReceipt = txHash => {\n      return this._handleError(this._postMessageToChild({\n        method: 'getTransactionReceipt',\n        params: txHash\n      }));\n    };\n\n    this.waitForTransactionReceipt = txHash => {\n      return this._handleError(this._postMessageToChild({\n        method: 'waitForTransactionReceipt',\n        params: txHash\n      }));\n    };\n\n    this.hasRecoveryEnabled = () => {\n      return this._handleError(this._postMessageToChild({\n        method: 'hasRecoveryEnabled'\n      }));\n    };\n\n    this.getEncryptionPublicKey = () => {\n      return this._handleError(this._postMessageToChild({\n        method: 'getEncryptionPublicKey'\n      }));\n    };\n\n    this.encryptMessage = message => {\n      return this._handleError(this._postMessageToChild({\n        method: 'encryptMessage',\n        params: message\n      }));\n    };\n\n    this.decryptMessage = encryptedMessage => {\n      return this._handleError(this._postMessageToChild({\n        method: 'decryptMessage',\n        params: encryptedMessage\n      }));\n    };\n\n    this.isContractDeployed = accountAddress => {\n      return this._handleError(this._postMessageToChild({\n        method: 'isContractDeployed',\n        params: accountAddress\n      }));\n    };\n\n    this._loadSigningKey = signingKey => __awaiter(this, void 0, void 0, function* () {\n      if (this._destroyed) {\n        console.warn('Authereum instance destroyed. Message not posted to child.');\n        return;\n      }\n\n      return this._postMessageToChild({\n        method: 'loadSigningKey',\n        params: signingKey\n      });\n    });\n\n    this._logAnalyticsEvent = input => __awaiter(this, void 0, void 0, function* () {\n      if (this._destroyed) {\n        console.warn('Authereum instance destroyed. Message not posted to child.');\n        return;\n      }\n\n      return this._postMessageToChild({\n        method: 'logAnalyticsEvent',\n        params: input\n      });\n    });\n\n    this._setupSigningKey = () => __awaiter(this, void 0, void 0, function* () {\n      yield this._tilReady();\n      const encryptedSigningKey = this._authereumQueryParams['encryptedSigningKey'];\n\n      if (encryptedSigningKey) {\n        const success = yield this._loadSigningKey(encryptedSigningKey);\n\n        if (success) {\n          try {\n            localStorage.removeItem('_authereum');\n          } catch (err) {// noop\n          }\n        }\n      }\n    });\n\n    this._cacheAuthereumQueryParams = () => __awaiter(this, void 0, void 0, function* () {\n      try {\n        const param = utils_1.getQueryParamValue('_authereum');\n\n        if (param) {\n          this._authereumQueryParams = JSON.parse(param);\n\n          try {\n            localStorage.setItem('_authereum', btoa(JSON.stringify(this._authereumQueryParams)));\n          } catch (err) {// noop\n          }\n\n          const newUrl = utils_1.removeQueryParam('_authereum');\n          utils_1.replaceWindowUrl(newUrl);\n        } else {\n          try {\n            // load from local storage cache if exists.\n            // this local storage is cleared after connection.\n            let cached = localStorage.getItem('_authereum');\n\n            if (cached) {\n              this._authereumQueryParams = JSON.parse(atob(cached));\n            }\n          } catch (err) {// noop\n          }\n        }\n      } catch (err) {// noop\n      }\n    });\n\n    this.destroy = () => __awaiter(this, void 0, void 0, function* () {\n      if (this._destroyed) {\n        console.warn('Authereum instance already destroyed.');\n        return true;\n      }\n\n      try {\n        if (this._iframeReady && this._bodyContainsIframe()) {\n          yield this._postMessageToChild({\n            method: 'destroy'\n          });\n        }\n      } catch (err) {\n        console.warn(err);\n      }\n\n      for (let i = 0; i < this._injectedElements.length; i++) {\n        const element = this._injectedElements[i];\n\n        try {\n          element.remove();\n        } catch (err) {\n          console.error(err);\n        }\n      }\n      /*\n      const elements = document.querySelectorAll('[id*=\"authereum\"]')\n      for (let i = 0; i < elements.length; i++) {\n        const element = elements[i]\n        try {\n          element.remove()\n        } catch (err) {\n          console.error(err)\n        }\n      }\n      */\n\n\n      this._iframeReady = false;\n      this._destroyed = true;\n      console.warn('Authereum instance destroyed.');\n\n      this._teardownEventListeners();\n\n      this.emit('destroy', {});\n      return true;\n    });\n\n    this.isDestroyed = () => {\n      return this._destroyed;\n    };\n\n    this.getAddressQrCodeDataUri = address => __awaiter(this, void 0, void 0, function* () {\n      return this._postMessageToChild({\n        method: 'getAddressQrCodeDataUri',\n        params: {\n          address\n        }\n      });\n    });\n\n    this._loadNotificationsIframe = url => __awaiter(this, void 0, void 0, function* () {\n      const id = 'authereum__x-notification-iframe';\n      let el = document.getElementById(id);\n\n      if (el && el.src === url) {\n        this._notificationIframe = el;\n      } else {\n        if (el) {\n          el.remove();\n        }\n\n        this._notificationIframe = this._constructIframe({\n          id,\n          url\n        });\n        this._notificationIframe.style.top = '0';\n        this._notificationIframe.style.right = '0';\n        yield this._tilDomReady();\n        el = document.getElementById(id);\n\n        if (el) {\n          el.remove();\n        }\n\n        document.body.appendChild(this._notificationIframe);\n      }\n    });\n\n    this._setDebug = enabled => __awaiter(this, void 0, void 0, function* () {\n      this._debug = enabled;\n\n      if (this._debug) {\n        this._iframe.style.outline = '1px solid red';\n        this._notificationIframe.style.outline = '1px solid red';\n      } else {\n        this._iframe.style.outline = '0';\n        this._notificationIframe.style.outline = '0';\n      }\n    });\n\n    this._userConfig = config;\n\n    if (config instanceof Object) {\n      this._isPreload = !!config.isPreload;\n      this._disableGoogleAnalytics = !!config.disableGoogleAnalytics;\n    }\n\n    const merged = this._checkCachedInstance(config);\n\n    if (merged) {\n      return merged;\n    }\n\n    this._init(config);\n\n    if (window._authereumInstances) {\n      window._authereumInstances.push(this);\n    }\n  }\n\n  _checkCachedInstance(config) {\n    let cachedInstance = null;\n\n    if (Array.isArray(window._authereumInstances)) {\n      if (window._authereumInstances.length) {\n        cachedInstance = window._authereumInstances.pop();\n      }\n    } // checks if preloaded cached iframe matches the same network as user created\n    // instance, and if so then merge the state to use preloaded iframe.\n\n\n    if (cachedInstance) {\n      if (cachedInstance.isReady()) {\n        if (typeof config === 'string') {\n          if (cachedInstance.getCachedNetworkName() === config) {\n            return this._merge(cachedInstance);\n          } else {\n            cachedInstance.destroy();\n            cachedInstance = null;\n          }\n        } else if (config instanceof Object) {\n          if (cachedInstance.getCachedNetworkName() === config.networkName && !config.xsUri) {\n            return this._merge(cachedInstance);\n          } else {\n            cachedInstance.destroy();\n            cachedInstance = null;\n          }\n        }\n      } else {\n        cachedInstance.destroy();\n        cachedInstance = null;\n      }\n    }\n  } // this merges an authereum instance with this one\n  // by copying all properties and connected iframes.\n\n\n  _merge(instance) {\n    this._debug = instance._debug;\n    this._apiKey = instance._apiKey;\n    this._apiUri = instance._apiUri;\n    this._rpcUri = instance._rpcUri;\n    this._webUri = instance._webUri;\n    this._xsUri = instance._xsUri;\n    this._notifierUri = instance._notifierUri;\n    this._networkName = instance._networkName;\n    this._networkId = instance._networkId;\n    this._redirectUri = instance._redirectUri;\n    this._iframeConnection = instance._iframeConnection;\n    this._childIframeConnection = instance._childIframeConnection;\n    this._iframe = instance._iframe;\n    this._notificationIframe = instance._notificationIframe;\n    this._cacheReady = instance._cacheReady;\n    this._cachedLoginKeyAddress = instance._cachedLoginKeyAddress;\n    this._cachedAccountAddress = instance._cachedAccountAddress;\n    this._cachedIsAuthenticated = instance._cachedIsAuthenticated;\n    this._iframeReady = instance._iframeReady;\n    this._configReady = instance._configReady;\n    this._iframeStyle = instance._iframeStyle;\n    this._notificationIframeStyle = instance._notificationIframeStyle;\n    this._heartbeatStarted = instance._heartbeatStarted;\n    this._backoffTimeout = instance._backoffTimeout;\n    this._asymmetricEncryptionKey = instance._asymmetricEncryptionKey;\n    this._authereumQueryParams = instance._authereumQueryParams;\n    this._injectedElements = instance._injectedElements;\n    this._notificationsMap = instance._notificationsMap;\n    instance._handlePostMessage = this._handlePostMessage.bind(instance);\n\n    this._initConfig(this._userConfig);\n\n    this._cacheLoginKeyAddress();\n\n    this._getConfigFromChild().then(config => {\n      this._setConfig(config);\n\n      this._postConfigToChild().catch(noop);\n\n      this.emit('iframeReady', {});\n    }).catch(noop);\n\n    this._emitReadyEvent();\n\n    this._provider = new AuthereumProvider_1.default(this);\n\n    this._refreshWidget();\n\n    return this;\n  }\n\n  _setupFocusListener() {\n    this.addEventListener('focus', this._handleWindowFocus, false);\n  }\n\n  _setupActionKeyListener() {\n    this.addEventListener('keydown', this._handleActionKeyPress, false);\n  }\n\n  _teardownEventListeners() {\n    for (let i = 0; i < this._eventListeners.length; i++) {\n      const {\n        type,\n        listener,\n        useCapture\n      } = this._eventListeners[i];\n      window.removeEventListener(type, listener, useCapture);\n    }\n  }\n\n  _getOrCreateMainIframe() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._iframe) {\n        if (this._iframeConnection) {\n          this._iframeConnection.destroy();\n        }\n\n        this._iframe.remove();\n      }\n\n      return new Promise(resolve => __awaiter(this, void 0, void 0, function* () {\n        const id = 'authereum__x-iframe';\n        let el = document.getElementById(id);\n\n        if (el && el.src === this._xsUri) {\n          this._iframe = el;\n        } else {\n          this._iframe = this._constructIframe({\n            id,\n            url: this._xsUri\n          });\n          let notificationIframeUrl = `${this._xsUri.replace(/\\/$/, '')}/notifications`;\n\n          this._loadNotificationsIframe(notificationIframeUrl).catch(noop);\n\n          resolve(this._iframe);\n          yield this._tilDomReady();\n          el = document.getElementById(id);\n\n          if (el) {\n            el.remove();\n          }\n\n          document.body.appendChild(this._iframe);\n\n          this._iframe.onload = () => {\n            this._postVersionToChild().catch(noop);\n\n            this._loadAsymmetricEncryptionKeyFromChild().catch(noop);\n\n            this._getConfigFromChild().then(config => {\n              if (notificationIframeUrl !== config.notifierIframeUri) {\n                this._loadNotificationsIframe(config.notifierIframeUri);\n              }\n\n              this._setConfig(config);\n\n              this._postConfigToChild().catch(noop);\n\n              this._configReady = true;\n              this.emit('iframeReady', {});\n            }).catch(noop);\n          };\n        }\n      }));\n    });\n  }\n\n  _bodyContainsIframe() {\n    return document.body.contains(this._iframe);\n  }\n\n  _getAuthereumPopupWindow(url) {\n    return window.open(url, 'Authereum', `toolbar=no,\n      location=no,\n      status=no,\n      menubar=no,\n      scrollbars=no,\n      resizable=no,\n      width=470,\n      height=640`);\n  }\n\n  _isAuthereumPopupBlocked(child) {\n    return child === null || child === undefined;\n  }\n\n  isPreload() {\n    return this._isPreload;\n  }\n\n}\n\nexports.default = Authereum; // keep both static and normal version methods\n\nAuthereum.version = () => {\n  return version_1.default;\n};\n\nif (typeof window !== 'undefined') {\n  window.Authereum = Authereum;\n  window._authereumInstances = []; // disable preloading if param set for debugging\n  // if (!getQueryParamValue('debug_disable_preload')) {\n\n  if (utils_1.getQueryParamValue('authereum_debug')) {\n    // preload instance in order to avoid async calls between\n    // user action and login call.\n    let cachedNetwork = 'mainnet';\n    const networks = ['kovan', 'goerli', 'rinkeby', 'ropsten'];\n\n    for (let i = 0; i < networks.length; i++) {\n      // assuming which network to preload\n      if (window.location.href.includes(networks[i])) {\n        cachedNetwork = networks[i];\n        break;\n      }\n    }\n\n    const cachedInstance = new Authereum({\n      networkName: cachedNetwork,\n      isPreload: true\n    });\n\n    window._authereumInstances.push(cachedInstance);\n  }\n}","map":{"version":3,"sources":["/Users/untitled/challenge-4-single-pool-dex/node_modules/authereum/dist/AuthereumSDK.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__importDefault","mod","__esModule","Object","defineProperty","exports","penpal_1","require","eventemitter3_1","is_buffer_1","version_1","AuthereumProvider_1","StarkWareProvider_1","ZkSyncProvider_1","config_1","utils_1","serializeMessageObj","obj","tx","k","v","toString","defaultIframeStyle","width","height","top","left","zIndex","noop","defaultNotifier","notify","type","message","console","debug","dismiss","constructIframe","input","id","url","isPreload","disableGoogleAnalytics","parentUrl","window","location","href","parent","document","URL","err","srcUrl","updateQueryParams","iframe","createElement","name","replace","title","src","includes","browserInfo","browser","setAttribute","style","position","bottom","right","border","background","onDomReady","readyState","addEventListener","Authereum","default","constructor","config","_debug","getQueryParamValue","_notifier","_cacheReady","_iframeReady","_configReady","_iframeConnecting","_readyEmitted","_widgetEnabled","_iframeStyle","_notificationIframeStyle","_blockedPopupRedirect","_forceRedirect","_heartbeatStarted","_backoffTimeout","_userConfig","_asymmetricEncryptionKey","_authereumQueryParams","_injectedElements","_notificationsMap","_destroyed","_starkProvider","_zkSyncProvider","_isPreload","_disableGoogleAnalytics","_eventListeners","_init","_initConfig","_provider","_connectToChildIframe","catch","_startHeartbeat","warn","_setupCache","_cacheAuthereumQueryParams","_setupSigningKey","_setupResizeListener","_setupFocusListener","_setupActionKeyListener","_emitReadyEvent","network","_networkName","trim","toLowerCase","_xsUri","defaultConfig","xsUri","Error","networkName","_apiKey","apiKey","redirectUri","_redirectUri","_setConfig","apiUri","rpcUri","webUri","notifierUri","networkId","disableNotifications","blockedPopupRedirect","forceRedirect","_apiUri","_rpcUri","_webUri","_notifierUri","_networkId","_disableNotifications","all","_cacheLoginKeyAddress","_cacheIsAuthenticated","_cacheAccountAddress","_handleWindowFocus","_bodyContainsIframe","_postMessageToChild","method","_resetCache","_injectScript","sourceUrl","_tilDomReady","getElementById","script","async","onload","onerror","push","getElementsByTagName","appendChild","_handleResizeThrottled","_handleResizeDebounced","_handleActionKeyPress","event","keyName","key","keyCode","params","_handleResize","size","_getWindowSize","throttle","debounce","loginKey","_cachedLoginKeyAddress","publicAddress","accountAddress","_cachedAccountAddress","isAuthenticated","_cachedIsAuthenticated","login","isIframeReady","isConfigReady","_tilConfigReady","_tilReady","_signLoginKeyRequest","getAuthenticatedAccount","timeout","setTimeout","account","authenticate","_handleError","logout","res","emit","getDappKey","getLoginKey","signMessage","options","signPersonalMessage","personal","signWithDappKey","signWithLoginKey","signTypedMessage","signTypedMessageWithDappKey","signMessageWithAdminKey","signMessageWithSigningKey","getSigningKeyAddress","getLoginKeyAuthSignature","getLoginKeyRestrictionsData","getSigningKeyAuthSignature","getAccountAddress","getBalance","getRpcUri","getNetworkId","getNetworkName","getCachedNetworkName","getProvider","getStarkProvider","getZkSyncProvider","promise","signTransaction","signTransactionWithLoginKey","sendTransaction","userTransaction","sendTransactionBatch","userTransactions","map","estimateGas","estimateGasBatch","isReady","updateConfig","getConfig","showWidget","enabled","hideWidget","widgetEnabled","addFunds","opts","_openUrl","newWindow","open","_tilIframeReady","wait","_getOrCreateMainIframe","_iframeConnection","connectToChild","methods","postMessage","data","_handlePostMessage","timedout","timer","child","clearTimeout","_childIframeConnection","reconnect","_heartbeat","_ping","test","pong","_constructIframe","assign","outline","_getConfigFromChild","_postVersionToChild","version","_postConfigToChild","_loadAsymmetricEncryptionKeyFromChild","payload","_teardownEventListeners","_handleChildLogoutEvent","_handleChildDappKeyExpired","loginKeyAddress","_refreshWidget","_refreshNotificationWidget","_handlePostMessageLog","_getWindowWidth","_getWindowHeight","innerWidth","documentElement","clientWidth","body","innerHeight","clientHeight","_setIframePositionLeft","x","_iframe","_setIframeWidth","_setIframeHeight","_notificationIframe","_loginKeyExists","_accountAddressExists","_getAccountAdminKeyNonce","_getAccountAuthKeyNonce","_executeLoginKeyMetaTx","_loadLoginKey","_getAuthenticateUri","encryptionKey","date","Date","setDate","getDate","expiresAt","getTime","encodeURIComponent","JSON","stringify","_getSignWithAdminKeyUri","_openPopupOrRedirect","_getAuthereumPopupWindow","isBlocked","_isAuthereumPopupBlocked","shouldShowPopupOrRedirect","_showConfirmPopupOrRedirectModal","errMessage","focus","interval","setInterval","closed","cleanUp","close","doneWithError","clearInterval","handleParentMessageEvent","origin","success","encryptedSigningKey","_loadSigningKey","_logAnalyticsEvent","eventType","properties","dapp_url","error","listener","useCapture","isAuthenticatedSync","getTransactionReceipt","txHash","waitForTransactionReceipt","hasRecoveryEnabled","getEncryptionPublicKey","encryptMessage","decryptMessage","encryptedMessage","isContractDeployed","signingKey","localStorage","removeItem","param","parse","setItem","btoa","newUrl","removeQueryParam","replaceWindowUrl","cached","getItem","atob","destroy","i","length","element","remove","isDestroyed","getAddressQrCodeDataUri","address","_loadNotificationsIframe","el","_setDebug","merged","_checkCachedInstance","_authereumInstances","cachedInstance","Array","isArray","pop","_merge","instance","bind","removeEventListener","notificationIframeUrl","notifierIframeUri","contains","undefined","cachedNetwork","networks"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst penpal_1 = __importDefault(require(\"penpal\"));\nconst eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\nconst is_buffer_1 = __importDefault(require(\"is-buffer\"));\nconst version_1 = __importDefault(require(\"./version\"));\nconst AuthereumProvider_1 = __importDefault(require(\"./AuthereumProvider\"));\nconst StarkWareProvider_1 = __importDefault(require(\"./StarkWareProvider\"));\nconst ZkSyncProvider_1 = __importDefault(require(\"./ZkSyncProvider\"));\nconst config_1 = require(\"./config\");\nconst utils_1 = require(\"./utils\");\n// Serialize object for postMessage to iframe.\n// Converts references to values.\nconst serializeMessageObj = (obj) => {\n    const tx = {};\n    for (let k in obj) {\n        let v = obj[k];\n        if (typeof v === 'object' && v.toString === 'function') {\n            v = v.toString('hex');\n        }\n        tx[k] = v;\n    }\n    return tx;\n};\nconst defaultIframeStyle = {\n    width: 0,\n    height: 0,\n    top: 0,\n    left: 0,\n    zIndex: 1\n};\nconst noop = () => {\n    // noop\n};\n// This is a placeholder notify object stub until notifier script url is\n// injected into page after iframe is loaded.\nconst defaultNotifier = {\n    notify: (type, message) => {\n        console.debug(type, message);\n        return {\n            dismiss: noop\n        };\n    }\n};\nconst constructIframe = (input) => {\n    const { id, url, isPreload, disableGoogleAnalytics } = input;\n    let parentUrl = window.location.href;\n    try {\n        parentUrl = parent.document.URL;\n    }\n    catch (err) {\n        // noop\n    }\n    const srcUrl = utils_1.updateQueryParams({\n        url: parentUrl,\n        isPreload,\n        disableGoogleAnalytics\n    }, url);\n    const iframe = document.createElement('iframe');\n    iframe.id = id;\n    iframe.name = id.replace(/--.*/, '');\n    iframe.title = id;\n    iframe.src = srcUrl;\n    if (['Safari', 'Firefox'].includes(utils_1.browserInfo().browser)) {\n        iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin');\n    }\n    iframe.style.position = 'fixed';\n    iframe.style.bottom = '0';\n    iframe.style.right = '0';\n    iframe.style.width = '0';\n    iframe.style.height = '0';\n    iframe.style.border = '0';\n    iframe.style.background = 'transparent';\n    iframe.style.zIndex = `${defaultIframeStyle.zIndex}`;\n    iframe.setAttribute('frameborder', '0');\n    iframe.setAttribute('scrolling', 'no');\n    return iframe;\n};\nconst onDomReady = () => {\n    return new Promise((resolve) => {\n        if (typeof window !== 'undefined') {\n            if (document.readyState !== 'loading') {\n                resolve();\n            }\n            else {\n                document.addEventListener('DOMContentLoaded', () => resolve());\n            }\n        }\n    });\n};\nclass Authereum extends eventemitter3_1.default {\n    constructor(config) {\n        super();\n        this._debug = !!utils_1.getQueryParamValue('debug');\n        this._notifier = defaultNotifier;\n        this._cacheReady = false;\n        this._iframeReady = false;\n        this._configReady = false;\n        this._iframeConnecting = null;\n        this._readyEmitted = false;\n        this._widgetEnabled = false;\n        this._iframeStyle = defaultIframeStyle;\n        this._notificationIframeStyle = defaultIframeStyle;\n        this._blockedPopupRedirect = true;\n        this._forceRedirect = false;\n        this._heartbeatStarted = false;\n        this._backoffTimeout = 1;\n        this._userConfig = null;\n        this._asymmetricEncryptionKey = null;\n        this._authereumQueryParams = {};\n        this._injectedElements = [];\n        this._notificationsMap = {};\n        this._destroyed = false;\n        this._starkProvider = null;\n        this._zkSyncProvider = null;\n        this._isPreload = false;\n        this._disableGoogleAnalytics = false;\n        this._eventListeners = [];\n        // NOTE: keep this sync\n        this._init = (config) => {\n            this._initConfig(config);\n            this._iframeStyle = {\n                width: 0,\n                height: 0,\n                top: 0,\n                left: 0,\n                zIndex: 0\n            };\n            this._provider = new AuthereumProvider_1.default(this);\n            this._connectToChildIframe()\n                .catch(() => {\n                this._startHeartbeat(true);\n            })\n                .catch((err) => {\n                console.warn('ping error:', err.message);\n            });\n            this._setupCache().catch(noop);\n            this._cacheAuthereumQueryParams();\n            this._setupSigningKey().catch(noop);\n            this._setupResizeListener();\n            this._setupFocusListener();\n            this._setupActionKeyListener();\n            this._emitReadyEvent();\n        };\n        // NOTE: keep this sync\n        this._initConfig = (config) => {\n            if (typeof config === 'string') {\n                let network = config;\n                this._networkName = (network || '').trim().toLowerCase();\n                if (['mainnet', 'ropsten', 'rinkeby', 'kovan', 'goerli'].includes(this._networkName)) {\n                    this._xsUri = config_1.defaultConfig.xsUri(this._networkName);\n                }\n                else if (config === 'localhost') {\n                    this._xsUri = 'http://localhost:3002';\n                    this._networkName = 'kovan';\n                }\n                else {\n                    throw new Error('Unsupported network');\n                }\n            }\n            else {\n                config = config || {};\n                this._networkName = config.networkName || 'mainnet';\n                this._xsUri = config.xsUri || config_1.defaultConfig.xsUri(this._networkName);\n                this._apiKey = config.apiKey;\n            }\n            if (config.redirectUri) {\n                this._redirectUri = config.redirectUri;\n            }\n            else {\n                this._redirectUri = window.location.href;\n            }\n            this._redirectUri = this._redirectUri || window.location.href;\n        };\n        // NOTE: keep this sync\n        this._setConfig = (config) => {\n            if (typeof this._userConfig === 'string') {\n                let network = this._userConfig;\n                this._networkName = (network || '').trim().toLowerCase();\n                this._userConfig = {\n                    networkName: this._networkName,\n                    xsUri: config_1.defaultConfig.xsUri(this._networkName)\n                };\n            }\n            const { apiKey, apiUri, rpcUri, webUri, notifierUri, networkName, networkId, disableNotifications, blockedPopupRedirect, forceRedirect } = this._userConfig || {};\n            if (apiKey) {\n                this._apiKey = apiKey;\n            }\n            // userConfig overrides regular config\n            if (apiUri) {\n                this._apiUri = apiUri;\n            }\n            else if (config.apiUri) {\n                this._apiUri = config.apiUri;\n            }\n            // userConfig overrides regular config\n            if (rpcUri) {\n                this._rpcUri = rpcUri;\n            }\n            else if (config.rpcUri) {\n                this._rpcUri = config.rpcUri;\n            }\n            // userConfig overrides regular config\n            if (webUri) {\n                this._webUri = webUri;\n            }\n            else if (config.webUri) {\n                this._webUri = config.webUri;\n            }\n            // userConfig overrides regular config\n            if (notifierUri) {\n                this._notifierUri = notifierUri;\n            }\n            else if (config.notifierUri) {\n                this._notifierUri = config.notifierUri;\n            }\n            // userConfig overrides regular config\n            if (networkName) {\n                this._networkName = networkName;\n            }\n            else if (config.networkName) {\n                this._networkName = config.networkName;\n            }\n            // userConfig overrides regular config\n            if (networkId) {\n                this._networkId = networkId;\n            }\n            else if (config.networkId) {\n                this._networkId = config.networkId;\n            }\n            // userConfig overrides regular config\n            if (typeof disableNotifications === 'boolean') {\n                this._disableNotifications = disableNotifications;\n            }\n            else if (typeof config.disableNotifications === 'boolean') {\n                this._disableNotifications = config.disableNotifications;\n            }\n            // userConfig overrides regular config\n            if (typeof blockedPopupRedirect === 'boolean') {\n                this._blockedPopupRedirect = blockedPopupRedirect;\n            }\n            else if (typeof config.blockedPopupRedirect === 'boolean') {\n                this._blockedPopupRedirect = config.blockedPopupRedirect;\n            }\n            // userConfig overrides regular config\n            if (typeof forceRedirect === 'boolean') {\n                this._forceRedirect = forceRedirect;\n            }\n            else if (typeof config.forceRedirect === 'boolean') {\n                this._forceRedirect = config.forceRedirect;\n            }\n        };\n        this._setupCache = () => __awaiter(this, void 0, void 0, function* () {\n            yield Promise.all([\n                this._cacheLoginKeyAddress(),\n                this._cacheIsAuthenticated(),\n                this._cacheAccountAddress()\n            ]);\n            this._cacheReady = true;\n        });\n        this._handleWindowFocus = () => {\n            if (this._destroyed) {\n                return;\n            }\n            if (!this._bodyContainsIframe()) {\n                return;\n            }\n            return this._postMessageToChild({\n                method: 'onWindowFocus'\n            });\n        };\n        this._resetCache = () => __awaiter(this, void 0, void 0, function* () {\n            return this._setupCache();\n        });\n        this._injectScript = (sourceUrl, id = '') => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilDomReady();\n            return new Promise((resolve, reject) => {\n                if (!sourceUrl) {\n                    throw new Error('sourceUrl is required');\n                }\n                if (document.getElementById(id)) {\n                    resolve();\n                    return;\n                }\n                const script = document.createElement('script');\n                script.id = id;\n                script.type = 'text/javascript';\n                script.async = true;\n                script.onload = () => {\n                    resolve();\n                };\n                script.onerror = (err) => {\n                    reject(err);\n                };\n                script.src = sourceUrl;\n                this._injectedElements.push(script);\n                document.getElementsByTagName('head')[0].appendChild(script);\n            });\n        });\n        this._setupResizeListener = () => __awaiter(this, void 0, void 0, function* () {\n            this.addEventListener('resize', this._handleResizeThrottled, false);\n            this.addEventListener('resize', this._handleResizeDebounced, false);\n        });\n        this._handleActionKeyPress = (event) => {\n            if (this._destroyed) {\n                return;\n            }\n            if (!this._bodyContainsIframe()) {\n                return;\n            }\n            let keyName = '';\n            if (event.key === 'Escape' || event.key === 'Esc' || event.keyCode === 27) {\n                keyName = 'escape';\n            }\n            else if (event.key === 'Enter' || event.keyCode === 13) {\n                keyName = 'enter';\n            }\n            else if (event.key === 'ArrowLeft' || event.keyCode === 37) {\n                keyName = 'left';\n            }\n            else if (event.key === 'ArrowUp' || event.keyCode === 38) {\n                keyName = 'up';\n            }\n            else if (event.key === 'ArrowRight' || event.keyCode === 39) {\n                keyName = 'right';\n            }\n            else if (event.key === 'ArrowDown' || event.keyCode === 40) {\n                keyName = 'down';\n            }\n            if (keyName) {\n                return this._postMessageToChild({\n                    method: 'actionKeyPress',\n                    params: keyName\n                });\n            }\n        };\n        this._handleResize = (event) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                return;\n            }\n            if (!this._bodyContainsIframe()) {\n                return;\n            }\n            const size = yield this._getWindowSize();\n            return this._postMessageToChild({\n                method: 'onResize',\n                params: size\n            });\n        });\n        this._handleResizeThrottled = utils_1.throttle((event) => {\n            return this._handleResize(event);\n        }, 10);\n        this._handleResizeDebounced = utils_1.debounce((event) => {\n            return this._handleResize(event);\n        }, 10);\n        this._cacheLoginKeyAddress = () => __awaiter(this, void 0, void 0, function* () {\n            const loginKey = yield this._postMessageToChild({\n                method: 'getOrCreateLoginKey'\n            });\n            this._cachedLoginKeyAddress = loginKey.publicAddress;\n        });\n        this._cacheAccountAddress = () => __awaiter(this, void 0, void 0, function* () {\n            const accountAddress = yield this._postMessageToChild({\n                method: 'getAccountAddress'\n            });\n            this._cachedAccountAddress = accountAddress;\n        });\n        this._cacheIsAuthenticated = () => __awaiter(this, void 0, void 0, function* () {\n            const isAuthenticated = yield this._postMessageToChild({\n                method: 'isAuthenticated'\n            });\n            this._cachedIsAuthenticated = isAuthenticated;\n        });\n        // NOTE: to prevent pop-ups from being blocked, there must be no awaits from\n        // click to window.open, meaning value lookups must be cached before the\n        // login method is called.\n        this.login = utils_1.throttle(() => __awaiter(this, void 0, void 0, function* () {\n            const isIframeReady = this._iframeReady && this._cacheReady;\n            const isConfigReady = this._configReady;\n            // these are false when dapp calls login immediately on page load\n            // so we're forced to wait here.\n            if (!(isIframeReady && isConfigReady)) {\n                yield this._tilConfigReady();\n                yield this._tilReady();\n            }\n            if (!this._cachedIsAuthenticated) {\n                // NOTE: if not logged in to dapp, then proceed to login\n                yield this._signLoginKeyRequest(this._cachedLoginKeyAddress);\n                return this.getAuthenticatedAccount();\n            }\n            else {\n                // only show one already logged in notification at a time\n                if (!this._notificationsMap['loggedIn']) {\n                    this._postMessageToChild({\n                        method: 'notification',\n                        params: {\n                            type: 'success',\n                            message: 'You are logged into Authereum',\n                            timeout: 5e3\n                        }\n                    })\n                        .catch(noop);\n                    this._notificationsMap['loggedIn'] = true;\n                    setTimeout(() => {\n                        this._notificationsMap['loggedIn'] = null;\n                    }, 5e3);\n                }\n            }\n            // await first\n            const account = yield this.getAuthenticatedAccount();\n            return account;\n        }), 250);\n        this.authenticate = () => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.authenticate()` is deprecated. Use `authereum.login()` instead.');\n            return this.login();\n        });\n        this.isAuthenticated = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'isAuthenticated'\n            }));\n        });\n        this.logout = () => __awaiter(this, void 0, void 0, function* () {\n            const res = yield this._postMessageToChild({\n                method: 'logout'\n            });\n            yield this._resetCache();\n            this.emit('logout', {});\n            return res;\n        });\n        this.getAuthenticatedAccount = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getAuthenticatedAccount'\n            }));\n        });\n        this.getDappKey = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'getLoginKey'\n            }));\n        };\n        this.getLoginKey = () => {\n            console.warn('Deprecation notice: `authereum.getLoginKey()` is deprecated. Use `authereum.getDappKey()` instead.');\n            return this.getDappKey();\n        };\n        this.signMessage = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'signMessage',\n                params: [message, options]\n            }));\n        }), 250);\n        this.signPersonalMessage = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'signMessage',\n                params: [message, { personal: true }]\n            }));\n        }), 250);\n        this.signWithDappKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signWithDappKey()` is deprecated. Use `authereum.signMess()` instead.');\n            return this.signMessage(message);\n        }), 250);\n        this.signWithLoginKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signWithLoginKey()` is deprecated. Use `authereum.signWithDappKey()` instead.');\n            return this.signWithDappKey(message);\n        }), 250);\n        this.signTypedMessage = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signTypedMessage()` is deprecated. Use `authereum.signMessage()` instead.');\n            return this.signMessage(message, options);\n        }), 250);\n        this.signTypedMessageWithDappKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signTypedMessageWithDappKey()` is deprecated. Use `authereum.signMessage()` instead.');\n            return this.signTypedMessage(message);\n        }), 250);\n        this.signMessageWithAdminKey = utils_1.throttle((message) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signMessageWithAdminKey()` is deprecated. Use `authereum.signMessageWithSigningKey()` instead.');\n            return null;\n        }), 250);\n        this.signMessageWithSigningKey = utils_1.throttle((message, options = {}) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'signMessageWithSigningKey',\n                params: [message, options]\n            }));\n        }), 250);\n        this.getSigningKeyAddress = (message) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getSigningKeyAddress'\n            }));\n        });\n        this.getLoginKeyAuthSignature = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getLoginKeyAuthSignature'\n            }));\n        });\n        this.getLoginKeyRestrictionsData = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getLoginKeyRestrictionsData'\n            }));\n        });\n        this.getSigningKeyAuthSignature = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getSigningKeyAuthSignature'\n            }));\n        });\n        this.getAccountAddress = () => __awaiter(this, void 0, void 0, function* () {\n            // required so it waits for login key to be set\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'getAccountAddress'\n            }));\n        });\n        this.getBalance = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getBalance'\n            }));\n        });\n        this.getRpcUri = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilConfigReady();\n            return this._rpcUri;\n        });\n        this.getNetworkId = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getNetworkId'\n            }));\n        });\n        this.getNetworkName = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getNetworkName'\n            }));\n        });\n        this.getCachedNetworkName = () => {\n            return this._networkName;\n        };\n        this.getProvider = () => {\n            return this._provider;\n        };\n        this.getStarkProvider = () => {\n            if (!this._starkProvider) {\n                this._starkProvider = new StarkWareProvider_1.default(this);\n            }\n            return this._starkProvider;\n        };\n        this.getZkSyncProvider = () => {\n            if (!this._zkSyncProvider) {\n                this._zkSyncProvider = new ZkSyncProvider_1.default(this);\n            }\n            return this._zkSyncProvider;\n        };\n        this._handleError = (promise) => __awaiter(this, void 0, void 0, function* () {\n            return promise\n                .catch((err) => {\n                // NOTE: emit errors but don't throw notification here.\n                this.emit('error', err);\n                // NOTE: rethrow error to let dapps handle error\n                throw err;\n            });\n        });\n        this.signTransaction = utils_1.throttle((tx) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'signTransaction',\n                params: serializeMessageObj(tx)\n            }));\n        }), 250);\n        this.signTransactionWithLoginKey = utils_1.throttle((tx) => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum.signTransactionWithLoginKey()` is deprecated. Use `authereum.signTransaction()` instead.');\n            return this.signTransaction(tx);\n        }), 250);\n        this.sendTransaction = utils_1.throttle((userTransaction) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'sendTransaction',\n                params: serializeMessageObj(userTransaction)\n            }));\n        }), 250);\n        this.sendTransactionBatch = utils_1.throttle((userTransactions) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'sendTransactionBatch',\n                params: userTransactions.map(serializeMessageObj)\n            }));\n        }), 250);\n        this.estimateGas = (userTransaction) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'estimateGasBatch',\n                params: serializeMessageObj(userTransaction)\n            }));\n        });\n        this.estimateGasBatch = (userTransactions) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'estimateGasBatch',\n                params: userTransactions.map(serializeMessageObj)\n            }));\n        });\n        this.isReady = () => {\n            return this._iframeReady && this._cacheReady;\n        };\n        this.updateConfig = (config) => {\n            this._userConfig = config;\n            this._setConfig(config);\n        };\n        this.getConfig = () => {\n            return {\n                apiUri: this._apiUri,\n                rpcUri: this._rpcUri,\n                webUri: this._webUri,\n                xsUri: this._xsUri,\n                networkName: this._networkName,\n                networkId: this._networkId,\n                disableNotifications: this._disableNotifications\n            };\n        };\n        this.showWidget = (enabled = true) => __awaiter(this, void 0, void 0, function* () {\n            if (!enabled) {\n                this._widgetEnabled = false;\n                return this._postMessageToChild({\n                    method: 'hideWidget'\n                });\n            }\n            this._widgetEnabled = true;\n            return this._postMessageToChild({\n                method: 'showWidget'\n            });\n        });\n        this.hideWidget = () => __awaiter(this, void 0, void 0, function* () {\n            this._widgetEnabled = false;\n            return this._postMessageToChild({\n                method: 'hideWidget'\n            });\n        });\n        this.widgetEnabled = () => {\n            return this._widgetEnabled;\n        };\n        this.addFunds = (opts) => {\n            return this._postMessageToChild({\n                method: 'addFunds',\n                params: opts\n            });\n        };\n        this._openUrl = (opts = {}) => {\n            const { url, newWindow } = opts;\n            if (newWindow) {\n                window.open(url, '_blank');\n            }\n            else {\n                window.location.href = url;\n            }\n        };\n        this._tilIframeReady = () => __awaiter(this, void 0, void 0, function* () {\n            if (!this._iframeReady) {\n                yield utils_1.wait(100);\n                return this._tilIframeReady();\n            }\n            yield utils_1.wait(100);\n            return true;\n        });\n        this._tilConfigReady = () => __awaiter(this, void 0, void 0, function* () {\n            if (!this._configReady) {\n                yield utils_1.wait(100);\n                return this._tilConfigReady();\n            }\n            yield utils_1.wait(100);\n            return true;\n        });\n        this._tilReady = () => __awaiter(this, void 0, void 0, function* () {\n            if (!this.isReady()) {\n                yield utils_1.wait(100);\n                return this._tilReady();\n            }\n            yield utils_1.wait(100);\n            return true;\n        });\n        this._emitReadyEvent = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            if (this._readyEmitted)\n                return;\n            this._readyEmitted = true;\n            this.emit('ready', {});\n        });\n        this._connectToChildIframe = () => __awaiter(this, void 0, void 0, function* () {\n            if (this._iframeConnecting) {\n                return this._iframeConnecting;\n            }\n            this._iframeReady = false;\n            this._iframeConnecting = true;\n            const iframe = yield this._getOrCreateMainIframe();\n            this._iframeConnection = penpal_1.default.connectToChild({\n                iframe,\n                timeout: 60e3,\n                methods: {\n                    // NOTE: the postMessage penpal method should be the only method that\n                    // exists.\n                    postMessage: (data) => {\n                        return this._handlePostMessage(data);\n                    }\n                }\n            });\n            this._iframeConnecting = new Promise((resolve, reject) => {\n                let timedout = false;\n                const timer = setTimeout(() => {\n                    if (!this._iframeReady) {\n                        timedout = true;\n                        this._iframeConnecting = null;\n                        reject(new Error('timedout'));\n                    }\n                }, 6e3); // needs to be long enough for x-site to be fully loaded\n                this._iframeConnection.promise.then((child) => {\n                    clearTimeout(timer);\n                    if (timedout) {\n                        return;\n                    }\n                    this._iframeReady = true;\n                    this._childIframeConnection = child;\n                    this._startHeartbeat();\n                    this._iframeConnecting = null;\n                    resolve();\n                })\n                    .catch((err) => {\n                    clearTimeout(timer);\n                    if (timedout) {\n                        return;\n                    }\n                    reject(err);\n                });\n            });\n            return this._iframeConnecting;\n        });\n        this._startHeartbeat = (reconnect = false) => {\n            if (!this._heartbeatStarted) {\n                this._heartbeat(reconnect);\n                this._heartbeatStarted = true;\n            }\n        };\n        this._heartbeat = (reconnect = false) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                return;\n            }\n            yield utils_1.wait(2e3);\n            try {\n                if (reconnect) {\n                    yield this._connectToChildIframe();\n                    this._backoffTimeout = 1;\n                    return this._heartbeat();\n                }\n                yield this._ping();\n            }\n            catch (err) {\n                // reconnect on destroyed connection error or ping timeout error\n                if (/destroy|timedout/gi.test(err.message)) {\n                    yield utils_1.wait(this._backoffTimeout * 1e3);\n                    // exponential backoff\n                    this._backoffTimeout = this._backoffTimeout << 1;\n                    return this._heartbeat(true);\n                }\n            }\n            return this._heartbeat();\n        });\n        this._ping = () => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return;\n            }\n            return new Promise((resolve, reject) => {\n                let timedout = false;\n                const timer = setTimeout(() => {\n                    timedout = true;\n                }, 5e3);\n                this._postMessageToChild({\n                    method: 'ping'\n                }).then((pong) => {\n                    clearTimeout(timer);\n                    if (timedout) {\n                        reject(new Error('timedout'));\n                        return;\n                    }\n                    if (pong !== 'pong') {\n                        reject(new Error('Invalid response'));\n                        return;\n                    }\n                    resolve(pong);\n                })\n                    .catch(err => {\n                    reject(err);\n                });\n            });\n        });\n        this._constructIframe = (input) => {\n            const iframe = constructIframe(Object.assign(Object.assign({}, input), { isPreload: this._isPreload, disableGoogleAnalytics: this._disableGoogleAnalytics }));\n            if (this._debug) {\n                iframe.style.outline = '1px solid red';\n            }\n            this._injectedElements.push(iframe);\n            return iframe;\n        };\n        this._getConfigFromChild = () => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'getConfig'\n            });\n        });\n        this._postVersionToChild = () => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'version',\n                params: this.version()\n            });\n        });\n        this._postConfigToChild = () => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'config',\n                params: {\n                    apiKey: this._apiKey,\n                    disableNotifications: this._disableNotifications\n                }\n            });\n        });\n        this._loadAsymmetricEncryptionKeyFromChild = () => __awaiter(this, void 0, void 0, function* () {\n            this._asymmetricEncryptionKey = yield this._postMessageToChild({\n                method: 'getAsymmetricEncryptionKey'\n            });\n        });\n        this._postMessageToChild = (payload) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilIframeReady();\n            if (this._destroyed) {\n                throw new Error('Authereum instance destroyed.');\n            }\n            if (!this._bodyContainsIframe()) {\n                this._destroyed = true;\n                this._teardownEventListeners();\n                // ignore destroy call to already destroyed iframe\n                if (payload.method === 'destroy') {\n                    return;\n                }\n                throw new Error('Authereum instance or iframe destroyed.');\n            }\n            return this._handleError(this._childIframeConnection.postMessage(payload));\n        });\n        this._handleChildLogoutEvent = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._resetCache();\n            this.emit('logout', {});\n        });\n        this._handleChildDappKeyExpired = (loginKeyAddress) => __awaiter(this, void 0, void 0, function* () {\n            if (loginKeyAddress === this._cachedLoginKeyAddress) {\n                yield this._resetCache();\n                this.emit('dappKeyExpired', loginKeyAddress);\n                this.emit('logout');\n            }\n        });\n        this._handlePostMessage = (data) => {\n            try {\n                const { method, params } = data;\n                switch (method) {\n                    case 'onError':\n                        const err = params;\n                        this.emit('error', err);\n                        this._notifier.notify({\n                            type: 'error',\n                            message: err.message\n                        });\n                        return;\n                    case 'onLogout':\n                        return this._handleChildLogoutEvent();\n                    case 'onDappKeyExpired':\n                        return this._handleChildDappKeyExpired(params);\n                    case 'login':\n                        return this.login();\n                    case 'setWidgetPosition':\n                        // const position = params\n                        // const { x, y } = position\n                        // this.iframeStyle.left = x\n                        // this.iframeStyle.top = y\n                        // this._refreshWidget()\n                        return;\n                    case 'setWidgetSize': {\n                        const size = params;\n                        const { width, height } = size;\n                        this._iframeStyle.width = width;\n                        this._iframeStyle.height = height;\n                        return this._refreshWidget();\n                    }\n                    case 'setWidgetStyle': {\n                        const style = params;\n                        for (let key in style) {\n                            this._iframeStyle[key] = style[key];\n                        }\n                        return this._refreshWidget();\n                    }\n                    case 'setNotificationWidgetSize': {\n                        const size = params;\n                        const { width, height } = size;\n                        this._notificationIframeStyle.width = width;\n                        this._notificationIframeStyle.height = height;\n                        return this._refreshNotificationWidget();\n                    }\n                    case 'setNotificationWidgetStyle': {\n                        const style = params;\n                        for (let key in style) {\n                            this._notificationIframeStyle[key] = style[key];\n                        }\n                        return this._refreshNotificationWidget();\n                    }\n                    case 'getWindowSize':\n                        return this._getWindowSize();\n                    case 'hideWidget':\n                        return this.hideWidget();\n                    case 'log':\n                        return this._handlePostMessageLog(params);\n                    case 'openUrl':\n                        return this._openUrl(params);\n                    default:\n                        break;\n                }\n            }\n            catch (err) {\n                // noop\n            }\n        };\n        this._handlePostMessageLog = (data) => {\n            if (this._isPreload) {\n                return;\n            }\n            let { type, message } = data;\n            if (!type) {\n                type = 'log';\n            }\n            console[type](message);\n        };\n        this._getWindowSize = () => {\n            return {\n                width: this._getWindowWidth(),\n                height: this._getWindowHeight()\n            };\n        };\n        this._getWindowWidth = () => {\n            return window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;\n        };\n        this._getWindowHeight = () => {\n            return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;\n        };\n        // public _setIframePositionTop = (y: number) => {\n        // if (!this._iframe) return\n        // this._iframe.style.top = `${y}px`\n        // }\n        this._setIframePositionLeft = (x) => {\n            if (!this._iframe)\n                return;\n            this._iframe.style.left = `${x}px`;\n        };\n        this._setIframeWidth = (width) => {\n            if (!this._iframe)\n                return;\n            this._iframe.style.width = `${width}px`;\n        };\n        this._setIframeHeight = (height) => {\n            if (!this._iframe)\n                return;\n            this._iframe.style.height = `${height}px`;\n        };\n        this._refreshWidget = () => {\n            const { top, left, width, height, zIndex } = this._iframeStyle;\n            if (this._isPreload)\n                return;\n            if (!this._iframe)\n                return;\n            // this._setIframePositionTop(top)\n            // this._setIframePositionLeft(left)\n            this._setIframeWidth(width);\n            this._setIframeHeight(height);\n            this._iframe.style.zIndex = `${zIndex || 0}`;\n        };\n        this._refreshNotificationWidget = () => {\n            const { top, left, width, height, zIndex } = this._notificationIframeStyle;\n            if (this._isPreload)\n                return;\n            this._notificationIframe.style.width = `${width}px`;\n            this._notificationIframe.style.height = `${height}px`;\n            this._notificationIframe.style.zIndex = `${zIndex || 0}`;\n        };\n        this._loginKeyExists = () => __awaiter(this, void 0, void 0, function* () {\n            return !!(yield this.getLoginKey());\n        });\n        this._accountAddressExists = () => __awaiter(this, void 0, void 0, function* () {\n            return !!(yield this.getAccountAddress());\n        });\n        this._getAccountAdminKeyNonce = () => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'getAccountAuthKeyNonce'\n            }));\n        });\n        this._getAccountAuthKeyNonce = () => __awaiter(this, void 0, void 0, function* () {\n            console.warn('Deprecation notice: `authereum._getAccountAuthKeyNonce()` is deprecated. Use `authereum._getAccountAdminKeyNonce()` instead.');\n            return this._getAccountAdminKeyNonce();\n        });\n        this._executeLoginKeyMetaTx = (tx) => __awaiter(this, void 0, void 0, function* () {\n            return this._handleError(this._postMessageToChild({\n                method: 'executeLoginKeyMetaTx',\n                params: serializeMessageObj(tx)\n            }));\n        });\n        this._loadLoginKey = (loginKey) => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            return this._handleError(this._postMessageToChild({\n                method: 'loadLoginKey',\n                params: loginKey\n            }));\n        });\n        this._getAuthenticateUri = (loginKeyAddress) => {\n            const encryptionKey = this._asymmetricEncryptionKey;\n            const date = new Date();\n            date.setDate(date.getDate() + 30); // expire in 30 days\n            const expiresAt = (date.getTime() / 1e3) | 0;\n            // NOTE: slk = sign login key\n            return this._webUri + '/?slk=' + encodeURIComponent(JSON.stringify({\n                loginKey: {\n                    publicAddress: loginKeyAddress,\n                    expiresAt\n                },\n                encryptionKey\n            })) + '&redirect_uri=' + this._redirectUri;\n        };\n        this._getSignWithAdminKeyUri = (message) => {\n            if (is_buffer_1.default(message)) {\n                message = `0x${message.toString('hex')}`;\n            }\n            // NOTE: sm = sign message\n            return this._webUri + '/?sm=' + encodeURIComponent(JSON.stringify({\n                message\n            })) + '&redirect_uri=' + this._redirectUri;\n        };\n        this._openPopupOrRedirect = (url) => __awaiter(this, void 0, void 0, function* () {\n            this.emit('openPopup', {});\n            if (this._forceRedirect) {\n                window.location.href = url;\n                return;\n            }\n            let child = this._getAuthereumPopupWindow(url);\n            let isBlocked = this._isAuthereumPopupBlocked(child);\n            if (isBlocked && !this._blockedPopupRedirect) {\n                const err = new Error('Disable popup blocker and try again');\n                this._notifier.notify({\n                    type: 'error',\n                    message: err.message,\n                    timeout: 5000\n                });\n                throw err;\n            }\n            else if (isBlocked) {\n                this.emit('popupBlocked');\n                const shouldShowPopupOrRedirect = yield this._showConfirmPopupOrRedirectModal();\n                if (!shouldShowPopupOrRedirect) {\n                    const errMessage = 'Popup or redirect rejected';\n                    this.emit('error', errMessage);\n                    throw new Error(errMessage);\n                }\n                // Try to bring up a user-initiated popup. If this fails\n                // fallback to a redirect\n                child = this._getAuthereumPopupWindow(url);\n                isBlocked = this._isAuthereumPopupBlocked(child);\n                if (isBlocked) {\n                    window.location.href = url;\n                    return;\n                }\n            }\n            child.focus();\n            return new Promise((resolve, reject) => {\n                const interval = setInterval(() => __awaiter(this, void 0, void 0, function* () {\n                    if (child.closed) {\n                        cleanUp();\n                        const err = new Error('Window closed');\n                        this.emit('error', err);\n                        this.emit('closePopup', {});\n                        reject(err);\n                    }\n                }), 250);\n                const timeout = setTimeout(() => {\n                    cleanUp();\n                    child.close();\n                    doneWithError(new Error('Timedout'));\n                }, 10 * 60 * 1000);\n                const cleanUp = () => {\n                    clearInterval(interval);\n                    clearTimeout(timeout);\n                    this.emit('closePopup', {});\n                };\n                const doneWithError = (err) => {\n                    cleanUp();\n                    this.emit('error', err);\n                    reject(err);\n                };\n                const done = (result = {}) => {\n                    cleanUp();\n                    resolve(result);\n                };\n                const handleParentMessageEvent = (event) => __awaiter(this, void 0, void 0, function* () {\n                    if (event.origin.includes(this._webUri)) {\n                        // this event tells parent to close child popup\n                        if (event.data.close) {\n                            child.close();\n                            done();\n                        }\n                        if (event.data.login) {\n                            done({ success: true });\n                            this.emit('login', {});\n                            this._cachedIsAuthenticated = true;\n                            if (event.data.encryptedSigningKey) {\n                                yield this._loadSigningKey(event.data.encryptedSigningKey);\n                            }\n                            this._logAnalyticsEvent({\n                                eventType: 'logged_in_dapp',\n                                properties: {\n                                    dapp_url: window.location.href\n                                }\n                            });\n                            if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                            }\n                        }\n                        if (event.data.result) {\n                            done(event.data.result);\n                            if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                            }\n                        }\n                        if (event.data.error) {\n                            doneWithError(new Error(event.data.error));\n                            if (this._redirectUri !== window.location.href) {\n                                window.location.href = this._redirectUri;\n                            }\n                        }\n                    }\n                });\n                this.addEventListener('message', handleParentMessageEvent, false);\n            });\n        });\n        this.addEventListener = (type, listener, useCapture = false) => {\n            window.addEventListener(type, listener, useCapture);\n            this._eventListeners.push({ type, listener, useCapture });\n        };\n        this._showConfirmPopupOrRedirectModal = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'showConfirmPopupOrRedirectModal'\n            }));\n        };\n        this._signLoginKeyRequest = (publicAddress) => __awaiter(this, void 0, void 0, function* () {\n            const url = this._getAuthenticateUri(publicAddress);\n            return this._openPopupOrRedirect(url);\n        });\n        this._tilDomReady = () => __awaiter(this, void 0, void 0, function* () {\n            return onDomReady();\n        });\n        // keep both static and normal version methods\n        this.version = () => {\n            return version_1.default;\n        };\n        this.isAuthenticatedSync = () => {\n            return this._cachedIsAuthenticated;\n        };\n        this.getTransactionReceipt = (txHash) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'getTransactionReceipt',\n                params: txHash\n            }));\n        };\n        this.waitForTransactionReceipt = (txHash) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'waitForTransactionReceipt',\n                params: txHash\n            }));\n        };\n        this.hasRecoveryEnabled = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'hasRecoveryEnabled'\n            }));\n        };\n        this.getEncryptionPublicKey = () => {\n            return this._handleError(this._postMessageToChild({\n                method: 'getEncryptionPublicKey'\n            }));\n        };\n        this.encryptMessage = (message) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'encryptMessage',\n                params: message\n            }));\n        };\n        this.decryptMessage = (encryptedMessage) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'decryptMessage',\n                params: encryptedMessage\n            }));\n        };\n        this.isContractDeployed = (accountAddress) => {\n            return this._handleError(this._postMessageToChild({\n                method: 'isContractDeployed',\n                params: accountAddress\n            }));\n        };\n        this._loadSigningKey = (signingKey) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return;\n            }\n            return this._postMessageToChild({\n                method: 'loadSigningKey',\n                params: signingKey\n            });\n        });\n        this._logAnalyticsEvent = (input) => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance destroyed. Message not posted to child.');\n                return;\n            }\n            return this._postMessageToChild({\n                method: 'logAnalyticsEvent',\n                params: input\n            });\n        });\n        this._setupSigningKey = () => __awaiter(this, void 0, void 0, function* () {\n            yield this._tilReady();\n            const encryptedSigningKey = this._authereumQueryParams['encryptedSigningKey'];\n            if (encryptedSigningKey) {\n                const success = yield this._loadSigningKey(encryptedSigningKey);\n                if (success) {\n                    try {\n                        localStorage.removeItem('_authereum');\n                    }\n                    catch (err) {\n                        // noop\n                    }\n                }\n            }\n        });\n        this._cacheAuthereumQueryParams = () => __awaiter(this, void 0, void 0, function* () {\n            try {\n                const param = utils_1.getQueryParamValue('_authereum');\n                if (param) {\n                    this._authereumQueryParams = JSON.parse(param);\n                    try {\n                        localStorage.setItem('_authereum', btoa(JSON.stringify(this._authereumQueryParams)));\n                    }\n                    catch (err) {\n                        // noop\n                    }\n                    const newUrl = utils_1.removeQueryParam('_authereum');\n                    utils_1.replaceWindowUrl(newUrl);\n                }\n                else {\n                    try {\n                        // load from local storage cache if exists.\n                        // this local storage is cleared after connection.\n                        let cached = localStorage.getItem('_authereum');\n                        if (cached) {\n                            this._authereumQueryParams = JSON.parse(atob(cached));\n                        }\n                    }\n                    catch (err) {\n                        // noop\n                    }\n                }\n            }\n            catch (err) {\n                // noop\n            }\n        });\n        this.destroy = () => __awaiter(this, void 0, void 0, function* () {\n            if (this._destroyed) {\n                console.warn('Authereum instance already destroyed.');\n                return true;\n            }\n            try {\n                if (this._iframeReady && this._bodyContainsIframe()) {\n                    yield this._postMessageToChild({\n                        method: 'destroy'\n                    });\n                }\n            }\n            catch (err) {\n                console.warn(err);\n            }\n            for (let i = 0; i < this._injectedElements.length; i++) {\n                const element = this._injectedElements[i];\n                try {\n                    element.remove();\n                }\n                catch (err) {\n                    console.error(err);\n                }\n            }\n            /*\n            const elements = document.querySelectorAll('[id*=\"authereum\"]')\n            for (let i = 0; i < elements.length; i++) {\n              const element = elements[i]\n              try {\n                element.remove()\n              } catch (err) {\n                console.error(err)\n              }\n            }\n            */\n            this._iframeReady = false;\n            this._destroyed = true;\n            console.warn('Authereum instance destroyed.');\n            this._teardownEventListeners();\n            this.emit('destroy', {});\n            return true;\n        });\n        this.isDestroyed = () => {\n            return this._destroyed;\n        };\n        this.getAddressQrCodeDataUri = (address) => __awaiter(this, void 0, void 0, function* () {\n            return this._postMessageToChild({\n                method: 'getAddressQrCodeDataUri',\n                params: {\n                    address\n                }\n            });\n        });\n        this._loadNotificationsIframe = (url) => __awaiter(this, void 0, void 0, function* () {\n            const id = 'authereum__x-notification-iframe';\n            let el = document.getElementById(id);\n            if (el && el.src === url) {\n                this._notificationIframe = el;\n            }\n            else {\n                if (el) {\n                    el.remove();\n                }\n                this._notificationIframe = this._constructIframe({ id, url });\n                this._notificationIframe.style.top = '0';\n                this._notificationIframe.style.right = '0';\n                yield this._tilDomReady();\n                el = document.getElementById(id);\n                if (el) {\n                    el.remove();\n                }\n                document.body.appendChild(this._notificationIframe);\n            }\n        });\n        this._setDebug = (enabled) => __awaiter(this, void 0, void 0, function* () {\n            this._debug = enabled;\n            if (this._debug) {\n                this._iframe.style.outline = '1px solid red';\n                this._notificationIframe.style.outline = '1px solid red';\n            }\n            else {\n                this._iframe.style.outline = '0';\n                this._notificationIframe.style.outline = '0';\n            }\n        });\n        this._userConfig = config;\n        if (config instanceof Object) {\n            this._isPreload = !!config.isPreload;\n            this._disableGoogleAnalytics = !!config.disableGoogleAnalytics;\n        }\n        const merged = this._checkCachedInstance(config);\n        if (merged) {\n            return merged;\n        }\n        this._init(config);\n        if (window._authereumInstances) {\n            window._authereumInstances.push(this);\n        }\n    }\n    _checkCachedInstance(config) {\n        let cachedInstance = null;\n        if (Array.isArray(window._authereumInstances)) {\n            if (window._authereumInstances.length) {\n                cachedInstance = window._authereumInstances.pop();\n            }\n        }\n        // checks if preloaded cached iframe matches the same network as user created\n        // instance, and if so then merge the state to use preloaded iframe.\n        if (cachedInstance) {\n            if (cachedInstance.isReady()) {\n                if (typeof config === 'string') {\n                    if (cachedInstance.getCachedNetworkName() === config) {\n                        return this._merge(cachedInstance);\n                    }\n                    else {\n                        cachedInstance.destroy();\n                        cachedInstance = null;\n                    }\n                }\n                else if (config instanceof Object) {\n                    if (cachedInstance.getCachedNetworkName() === config.networkName &&\n                        !config.xsUri) {\n                        return this._merge(cachedInstance);\n                    }\n                    else {\n                        cachedInstance.destroy();\n                        cachedInstance = null;\n                    }\n                }\n            }\n            else {\n                cachedInstance.destroy();\n                cachedInstance = null;\n            }\n        }\n    }\n    // this merges an authereum instance with this one\n    // by copying all properties and connected iframes.\n    _merge(instance) {\n        this._debug = instance._debug;\n        this._apiKey = instance._apiKey;\n        this._apiUri = instance._apiUri;\n        this._rpcUri = instance._rpcUri;\n        this._webUri = instance._webUri;\n        this._xsUri = instance._xsUri;\n        this._notifierUri = instance._notifierUri;\n        this._networkName = instance._networkName;\n        this._networkId = instance._networkId;\n        this._redirectUri = instance._redirectUri;\n        this._iframeConnection = instance._iframeConnection;\n        this._childIframeConnection = instance._childIframeConnection;\n        this._iframe = instance._iframe;\n        this._notificationIframe = instance._notificationIframe;\n        this._cacheReady = instance._cacheReady;\n        this._cachedLoginKeyAddress = instance._cachedLoginKeyAddress;\n        this._cachedAccountAddress = instance._cachedAccountAddress;\n        this._cachedIsAuthenticated = instance._cachedIsAuthenticated;\n        this._iframeReady = instance._iframeReady;\n        this._configReady = instance._configReady;\n        this._iframeStyle = instance._iframeStyle;\n        this._notificationIframeStyle = instance._notificationIframeStyle;\n        this._heartbeatStarted = instance._heartbeatStarted;\n        this._backoffTimeout = instance._backoffTimeout;\n        this._asymmetricEncryptionKey = instance._asymmetricEncryptionKey;\n        this._authereumQueryParams = instance._authereumQueryParams;\n        this._injectedElements = instance._injectedElements;\n        this._notificationsMap = instance._notificationsMap;\n        instance._handlePostMessage = this._handlePostMessage.bind(instance);\n        this._initConfig(this._userConfig);\n        this._cacheLoginKeyAddress();\n        this._getConfigFromChild()\n            .then((config) => {\n            this._setConfig(config);\n            this._postConfigToChild().catch(noop);\n            this.emit('iframeReady', {});\n        })\n            .catch(noop);\n        this._emitReadyEvent();\n        this._provider = new AuthereumProvider_1.default(this);\n        this._refreshWidget();\n        return this;\n    }\n    _setupFocusListener() {\n        this.addEventListener('focus', this._handleWindowFocus, false);\n    }\n    _setupActionKeyListener() {\n        this.addEventListener('keydown', this._handleActionKeyPress, false);\n    }\n    _teardownEventListeners() {\n        for (let i = 0; i < this._eventListeners.length; i++) {\n            const { type, listener, useCapture } = this._eventListeners[i];\n            window.removeEventListener(type, listener, useCapture);\n        }\n    }\n    _getOrCreateMainIframe() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._iframe) {\n                if (this._iframeConnection) {\n                    this._iframeConnection.destroy();\n                }\n                this._iframe.remove();\n            }\n            return new Promise((resolve) => __awaiter(this, void 0, void 0, function* () {\n                const id = 'authereum__x-iframe';\n                let el = document.getElementById(id);\n                if (el && el.src === this._xsUri) {\n                    this._iframe = el;\n                }\n                else {\n                    this._iframe = this._constructIframe({ id, url: this._xsUri });\n                    let notificationIframeUrl = `${this._xsUri.replace(/\\/$/, '')}/notifications`;\n                    this._loadNotificationsIframe(notificationIframeUrl).catch(noop);\n                    resolve(this._iframe);\n                    yield this._tilDomReady();\n                    el = document.getElementById(id);\n                    if (el) {\n                        el.remove();\n                    }\n                    document.body.appendChild(this._iframe);\n                    this._iframe.onload = () => {\n                        this._postVersionToChild().catch(noop);\n                        this._loadAsymmetricEncryptionKeyFromChild().catch(noop);\n                        this._getConfigFromChild()\n                            .then((config) => {\n                            if (notificationIframeUrl !== config.notifierIframeUri) {\n                                this._loadNotificationsIframe(config.notifierIframeUri);\n                            }\n                            this._setConfig(config);\n                            this._postConfigToChild().catch(noop);\n                            this._configReady = true;\n                            this.emit('iframeReady', {});\n                        })\n                            .catch(noop);\n                    };\n                }\n            }));\n        });\n    }\n    _bodyContainsIframe() {\n        return document.body.contains(this._iframe);\n    }\n    _getAuthereumPopupWindow(url) {\n        return window.open(url, 'Authereum', `toolbar=no,\n      location=no,\n      status=no,\n      menubar=no,\n      scrollbars=no,\n      resizable=no,\n      width=470,\n      height=640`);\n    }\n    _isAuthereumPopupBlocked(child) {\n        return (child === null || child === undefined);\n    }\n    isPreload() {\n        return this._isPreload;\n    }\n}\nexports.default = Authereum;\n// keep both static and normal version methods\nAuthereum.version = () => {\n    return version_1.default;\n};\nif (typeof window !== 'undefined') {\n    window.Authereum = Authereum;\n    window._authereumInstances = [];\n    // disable preloading if param set for debugging\n    // if (!getQueryParamValue('debug_disable_preload')) {\n    if (utils_1.getQueryParamValue('authereum_debug')) {\n        // preload instance in order to avoid async calls between\n        // user action and login call.\n        let cachedNetwork = 'mainnet';\n        const networks = ['kovan', 'goerli', 'rinkeby', 'ropsten'];\n        for (let i = 0; i < networks.length; i++) {\n            // assuming which network to preload\n            if (window.location.href.includes(networks[i])) {\n                cachedNetwork = networks[i];\n                break;\n            }\n        }\n        const cachedInstance = new Authereum({\n            networkName: cachedNetwork,\n            isPreload: true\n        });\n        window._authereumInstances.push(cachedInstance);\n    }\n}\n"]},"metadata":{},"sourceType":"script"}