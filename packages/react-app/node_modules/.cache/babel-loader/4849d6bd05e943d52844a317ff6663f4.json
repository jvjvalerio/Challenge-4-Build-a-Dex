{"ast":null,"code":"import _slicedToArray from\"/Users/untitled/challenge-4-single-pool-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/Users/untitled/challenge-4-single-pool-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/untitled/challenge-4-single-pool-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/untitled/challenge-4-single-pool-dex/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{RetweetOutlined,SettingOutlined}from\"@ant-design/icons\";import{ChainId,Fetcher,Percent,Token,TokenAmount,Trade,WETH}from\"@uniswap/sdk\";import{abi as IUniswapV2Router02ABI}from\"@uniswap/v2-periphery/build/IUniswapV2Router02.json\";import{Button,Card,Descriptions,Divider,Drawer,InputNumber,Modal,notification,Row,Select,Space,Tooltip,Typography}from\"antd\";import{useBlockNumber,usePoller}from\"eth-hooks\";import{ethers}from\"ethers\";import React,{useEffect,useState}from\"react\";import{useDebounce}from\"../hooks\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Option=Select.Option;var Text=Typography.Text;export var ROUTER_ADDRESS=\"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D\";export var ZERO_ADDRESS=\"0x0000000000000000000000000000000000000000\";var erc20Abi=[\"function balanceOf(address owner) view returns (uint256)\",\"function approve(address _spender, uint256 _value) public returns (bool success)\",\"function allowance(address _owner, address _spender) public view returns (uint256 remaining)\"];var makeCall=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(callName,contract,args){var metadata,result,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:metadata=_args.length>3&&_args[3]!==undefined?_args[3]:{};if(!contract[callName]){_context.next=12;break;}if(!args){_context.next=8;break;}_context.next=5;return contract[callName].apply(contract,_toConsumableArray(args).concat([metadata]));case 5:result=_context.sent;_context.next=11;break;case 8:_context.next=10;return contract[callName]();case 10:result=_context.sent;case 11:return _context.abrupt(\"return\",result);case 12:console.log(\"no call of that name!\");return _context.abrupt(\"return\",undefined);case 14:case\"end\":return _context.stop();}}},_callee);}));return function makeCall(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var defaultToken=\"ETH\";var defaultTokenOut=\"DAI\";var defaultSlippage=\"0.5\";var defaultTimeLimit=60*10;var tokenListToObject=function tokenListToObject(array){return array.reduce(function(obj,item){obj[item.symbol]=new Token(item.chainId,item.address,item.decimals,item.symbol,item.name);return obj;},{});};function Swap(_ref2){var selectedProvider=_ref2.selectedProvider,tokenListURI=_ref2.tokenListURI;var _useState=useState(defaultToken),_useState2=_slicedToArray(_useState,2),tokenIn=_useState2[0],setTokenIn=_useState2[1];var _useState3=useState(defaultTokenOut),_useState4=_slicedToArray(_useState3,2),tokenOut=_useState4[0],setTokenOut=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),exact=_useState6[0],setExact=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),amountIn=_useState8[0],setAmountIn=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),amountInMax=_useState10[0],setAmountInMax=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),amountOut=_useState12[0],setAmountOut=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),amountOutMin=_useState14[0],setAmountOutMin=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),trades=_useState16[0],setTrades=_useState16[1];var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),routerAllowance=_useState18[0],setRouterAllowance=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),balanceIn=_useState20[0],setBalanceIn=_useState20[1];var _useState21=useState(),_useState22=_slicedToArray(_useState21,2),balanceOut=_useState22[0],setBalanceOut=_useState22[1];var _useState23=useState(new Percent(Math.round(defaultSlippage*100).toString(),\"10000\")),_useState24=_slicedToArray(_useState23,2),slippageTolerance=_useState24[0],setSlippageTolerance=_useState24[1];var _useState25=useState(defaultTimeLimit),_useState26=_slicedToArray(_useState25,2),timeLimit=_useState26[0],setTimeLimit=_useState26[1];var _useState27=useState(false),_useState28=_slicedToArray(_useState27,2),swapping=_useState28[0],setSwapping=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),approving=_useState30[0],setApproving=_useState30[1];var _useState31=useState(false),_useState32=_slicedToArray(_useState31,2),settingsVisible=_useState32[0],setSettingsVisible=_useState32[1];var _useState33=useState(false),_useState34=_slicedToArray(_useState33,2),swapModalVisible=_useState34[0],setSwapModalVisible=_useState34[1];var _useState35=useState([]),_useState36=_slicedToArray(_useState35,2),tokenList=_useState36[0],setTokenList=_useState36[1];var _useState37=useState(),_useState38=_slicedToArray(_useState37,2),tokens=_useState38[0],setTokens=_useState38[1];var _useState39=useState(false),_useState40=_slicedToArray(_useState39,2),invertPrice=_useState40[0],setInvertPrice=_useState40[1];var blockNumber=useBlockNumber(selectedProvider,3000);var signer=selectedProvider.getSigner();var routerContract=new ethers.Contract(ROUTER_ADDRESS,IUniswapV2Router02ABI,signer);var _tokenListUri=tokenListURI||\"https://gateway.ipfs.io/ipns/tokens.uniswap.org\";var debouncedAmountIn=useDebounce(amountIn,500);var debouncedAmountOut=useDebounce(amountOut,500);var activeChainId=process.env.REACT_APP_NETWORK===\"kovan\"?ChainId.KOVAN:ChainId.MAINNET;useEffect(function(){var getTokenList=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var tokenListResponse,tokenListJson,filteredTokens,ethToken,_tokenList,_tokens;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(_tokenListUri);_context2.prev=1;_context2.next=4;return fetch(_tokenListUri);case 4:tokenListResponse=_context2.sent;_context2.next=7;return tokenListResponse.json();case 7:tokenListJson=_context2.sent;filteredTokens=tokenListJson.tokens.filter(function(t){return t.chainId===activeChainId;});ethToken=WETH[activeChainId];ethToken.name=\"Ethereum\";ethToken.symbol=\"ETH\";ethToken.logoURI=\"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png\";_tokenList=[ethToken].concat(_toConsumableArray(filteredTokens));setTokenList(_tokenList);_tokens=tokenListToObject(_tokenList);setTokens(_tokens);_context2.next=22;break;case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[1,19]]);}));return function getTokenList(){return _ref3.apply(this,arguments);};}();getTokenList();},[tokenListURI,_tokenListUri,activeChainId]);var getTrades=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var pairs,baseTokens,listOfPairwiseTokens,getPairs,listOfPairs,bestTrade;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(tokenIn&&tokenOut&&(amountIn||amountOut))){_context4.next=11;break;}pairs=function pairs(arr){return arr.map(function(v,i){return arr.slice(i+1).map(function(w){return[v,w];});}).flat();};baseTokens=tokenList.filter(function(t){return[\"DAI\",\"USDC\",\"USDT\",\"COMP\",\"ETH\",\"MKR\",\"LINK\",tokenIn,tokenOut].includes(t.symbol);}).map(function(el){return new Token(el.chainId,el.address,el.decimals,el.symbol,el.name);});listOfPairwiseTokens=pairs(baseTokens);getPairs=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(list){var listOfPromises;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:listOfPromises=list.map(function(item){return Fetcher.fetchPairData(item[0],item[1],selectedProvider);});return _context3.abrupt(\"return\",Promise.all(listOfPromises.map(function(p){return p.catch(function(){return undefined;});})));case 2:case\"end\":return _context3.stop();}}},_callee3);}));return function getPairs(_x4){return _ref5.apply(this,arguments);};}();_context4.next=7;return getPairs(listOfPairwiseTokens);case 7:listOfPairs=_context4.sent;if(exact===\"in\"){setAmountInMax();bestTrade=Trade.bestTradeExactIn(listOfPairs.filter(function(item){return item;}),new TokenAmount(tokens[tokenIn],ethers.utils.parseUnits(amountIn.toString(),tokens[tokenIn].decimals)),tokens[tokenOut],{maxNumResults:3,maxHops:1});if(bestTrade[0]){setAmountOut(bestTrade[0].outputAmount.toSignificant(6));}else{setAmountOut();}}else if(exact===\"out\"){setAmountOutMin();bestTrade=Trade.bestTradeExactOut(listOfPairs.filter(function(item){return item;}),tokens[tokenIn],new TokenAmount(tokens[tokenOut],ethers.utils.parseUnits(amountOut.toString(),tokens[tokenOut].decimals)),{maxNumResults:3,maxHops:1});if(bestTrade[0]){setAmountIn(bestTrade[0].inputAmount.toSignificant(6));}else{setAmountIn();}}setTrades(bestTrade);console.log(bestTrade);case 11:case\"end\":return _context4.stop();}}},_callee4);}));return function getTrades(){return _ref4.apply(this,arguments);};}();useEffect(function(){getTrades();// eslint-disable-next-line\n},[tokenIn,tokenOut,debouncedAmountIn,debouncedAmountOut,slippageTolerance,selectedProvider]);useEffect(function(){if(trades&&trades[0]){if(exact===\"in\"){setAmountOutMin(trades[0].minimumAmountOut(slippageTolerance));}else if(exact===\"out\"){setAmountInMax(trades[0].maximumAmountIn(slippageTolerance));}}},[slippageTolerance,amountIn,amountOut,trades,exact]);var getBalance=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(_token,_account,_contract){var newBalance;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!(_token===\"ETH\")){_context5.next=6;break;}_context5.next=3;return selectedProvider.getBalance(_account);case 3:newBalance=_context5.sent;_context5.next=9;break;case 6:_context5.next=8;return makeCall(\"balanceOf\",_contract,[_account]);case 8:newBalance=_context5.sent;case 9:return _context5.abrupt(\"return\",newBalance);case 10:case\"end\":return _context5.stop();}}},_callee5);}));return function getBalance(_x5,_x6,_x7){return _ref6.apply(this,arguments);};}();var getAccountInfo=/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){var accountList,tempContractIn,newBalanceIn,allowance,tempContractOut,newBalanceOut;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:if(!tokens){_context6.next=24;break;}_context6.next=3;return selectedProvider.listAccounts();case 3:accountList=_context6.sent;if(!tokenIn){_context6.next=18;break;}tempContractIn=new ethers.Contract(tokens[tokenIn].address,erc20Abi,selectedProvider);_context6.next=8;return getBalance(tokenIn,accountList[0],tempContractIn);case 8:newBalanceIn=_context6.sent;setBalanceIn(newBalanceIn);if(!(tokenIn===\"ETH\")){_context6.next=14;break;}setRouterAllowance();_context6.next=18;break;case 14:_context6.next=16;return makeCall(\"allowance\",tempContractIn,[accountList[0],ROUTER_ADDRESS]);case 16:allowance=_context6.sent;setRouterAllowance(allowance);case 18:if(!tokenOut){_context6.next=24;break;}tempContractOut=new ethers.Contract(tokens[tokenOut].address,erc20Abi,selectedProvider);_context6.next=22;return getBalance(tokenOut,accountList[0],tempContractOut);case 22:newBalanceOut=_context6.sent;setBalanceOut(newBalanceOut);case 24:case\"end\":return _context6.stop();}}},_callee6);}));return function getAccountInfo(){return _ref7.apply(this,arguments);};}();usePoller(getAccountInfo,6000);var route=trades?trades.length>0?trades[0].route.path.map(function(item){return item.symbol;}):[]:[];var updateRouterAllowance=/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(newAllowance){var tempContract,result;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:setApproving(true);_context7.prev=1;tempContract=new ethers.Contract(tokens[tokenIn].address,erc20Abi,signer);_context7.next=5;return makeCall(\"approve\",tempContract,[ROUTER_ADDRESS,newAllowance]);case 5:result=_context7.sent;console.log(result);setApproving(false);return _context7.abrupt(\"return\",true);case 11:_context7.prev=11;_context7.t0=_context7[\"catch\"](1);notification.open({message:\"Approval unsuccessful\",description:\"Error: \".concat(_context7.t0.message)});case 14:case\"end\":return _context7.stop();}}},_callee7,null,[[1,11]]);}));return function updateRouterAllowance(_x8){return _ref8.apply(this,arguments);};}();var approveRouter=/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){var approvalAmount,approval;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:approvalAmount=exact===\"in\"?ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(),tokens[tokenIn].decimals)):amountInMax.raw.toString();console.log(approvalAmount);approval=updateRouterAllowance(approvalAmount);if(approval){notification.open({message:\"Token transfer approved\",description:\"You can now swap up to \".concat(amountIn,\" \").concat(tokenIn)});}case 4:case\"end\":return _context8.stop();}}},_callee8);}));return function approveRouter(){return _ref9.apply(this,arguments);};}();var removeRouterAllowance=/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){var approvalAmount,removal;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:approvalAmount=ethers.utils.hexlify(0);console.log(approvalAmount);removal=updateRouterAllowance(approvalAmount);if(removal){notification.open({message:\"Token approval removed\",description:\"The router is no longer approved for \".concat(tokenIn)});}case 4:case\"end\":return _context9.stop();}}},_callee9);}));return function removeRouterAllowance(){return _ref10.apply(this,arguments);};}();var executeSwap=/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){var args,metadata,call,deadline,path,accountList,address,_amountIn,_amountOutMin,_amountOut,_amountInMax,result;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:setSwapping(true);_context10.prev=1;metadata={};deadline=Math.floor(Date.now()/1000)+timeLimit;path=trades[0].route.path.map(function(item){return item.address;});console.log(path);_context10.next=8;return selectedProvider.listAccounts();case 8:accountList=_context10.sent;address=accountList[0];if(exact===\"in\"){_amountIn=ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(),tokens[tokenIn].decimals));_amountOutMin=ethers.utils.hexlify(ethers.BigNumber.from(amountOutMin.raw.toString()));if(tokenIn===\"ETH\"){call=\"swapExactETHForTokens\";args=[_amountOutMin,path,address,deadline];metadata.value=_amountIn;}else{call=tokenOut===\"ETH\"?\"swapExactTokensForETH\":\"swapExactTokensForTokens\";args=[_amountIn,_amountOutMin,path,address,deadline];}}else if(exact===\"out\"){_amountOut=ethers.utils.hexlify(ethers.utils.parseUnits(amountOut.toString(),tokens[tokenOut].decimals));_amountInMax=ethers.utils.hexlify(ethers.BigNumber.from(amountInMax.raw.toString()));if(tokenIn===\"ETH\"){call=\"swapETHForExactTokens\";args=[_amountOut,path,address,deadline];metadata.value=_amountInMax;}else{call=tokenOut===\"ETH\"?\"swapTokensForExactETH\":\"swapTokensForExactTokens\";args=[_amountOut,_amountInMax,path,address,deadline];}}console.log(call,args,metadata);_context10.next=14;return makeCall(call,routerContract,args,metadata);case 14:result=_context10.sent;console.log(result);notification.open({message:\"Swap complete 🦄\",description:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Text,{children:\"Swapped \".concat(tokenIn,\" for \").concat(tokenOut,\", transaction: \")}),/*#__PURE__*/_jsx(Text,{copyable:true,children:result.hash})]})});setSwapping(false);_context10.next=25;break;case 20:_context10.prev=20;_context10.t0=_context10[\"catch\"](1);console.log(_context10.t0);setSwapping(false);notification.open({message:\"Swap unsuccessful\",description:\"Error: \".concat(_context10.t0.message)});case 25:case\"end\":return _context10.stop();}}},_callee10,null,[[1,20]]);}));return function executeSwap(){return _ref11.apply(this,arguments);};}();var showSwapModal=function showSwapModal(){setSwapModalVisible(true);};var handleSwapModalOk=function handleSwapModalOk(){setSwapModalVisible(false);executeSwap();};var handleSwapModalCancel=function handleSwapModalCancel(){setSwapModalVisible(false);};var insufficientBalance=balanceIn?parseFloat(ethers.utils.formatUnits(balanceIn,tokens[tokenIn].decimals))<amountIn:null;var inputIsToken=tokenIn!==\"ETH\";var insufficientAllowance=!inputIsToken?false:routerAllowance?parseFloat(ethers.utils.formatUnits(routerAllowance,tokens[tokenIn].decimals))<amountIn:null;var formattedBalanceIn=balanceIn?parseFloat(ethers.utils.formatUnits(balanceIn,tokens[tokenIn].decimals)).toPrecision(6):null;var formattedBalanceOut=balanceOut?parseFloat(ethers.utils.formatUnits(balanceOut,tokens[tokenOut].decimals)).toPrecision(6):null;var metaIn=tokens&&tokenList&&tokenIn?tokenList.filter(function(t){return t.address===tokens[tokenIn].address;})[0]:null;var metaOut=tokens&&tokenList&&tokenOut?tokenList.filter(function(t){return t.address===tokens[tokenOut].address;})[0]:null;var cleanIpfsURI=function cleanIpfsURI(uri){try{return uri.replace(\"ipfs://\",\"https://ipfs.io/ipfs/\");}catch(e){console.log(e,uri);return uri;}};var logoIn=metaIn?cleanIpfsURI(metaIn.logoURI):null;var logoOut=metaOut?cleanIpfsURI(metaOut.logoURI):null;var rawPrice=trades&&trades[0]?trades[0].executionPrice:null;var price=rawPrice?rawPrice.toSignificant(7):null;var priceDescription=rawPrice?invertPrice?\"\".concat(rawPrice.invert().toSignificant(7),\" \").concat(tokenIn,\" per \").concat(tokenOut):\"\".concat(price,\" \").concat(tokenOut,\" per \").concat(tokenIn):null;var priceWidget=/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:priceDescription}),/*#__PURE__*/_jsx(Button,{type:\"text\",onClick:function onClick(){setInvertPrice(!invertPrice);},children:/*#__PURE__*/_jsx(RetweetOutlined,{})})]});var swapModal=/*#__PURE__*/_jsxs(Modal,{title:\"Confirm swap\",visible:swapModalVisible,onOk:handleSwapModalOk,onCancel:handleSwapModalCancel,children:[/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoIn,alt:tokenIn,width:\"30\"}),amountIn,tokenIn]})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",style:{width:30},children:/*#__PURE__*/_jsx(\"span\",{children:\"\\u2193\"})}),/*#__PURE__*/_jsx(Row,{children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoOut,alt:tokenOut,width:\"30\"}),amountOut,tokenOut]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsx(Row,{children:priceWidget}),/*#__PURE__*/_jsx(Row,{children:trades&&(amountOutMin&&exact===\"in\"||amountInMax&&exact===\"out\")?exact===\"in\"?\"Output is estimated. You will receive at least \".concat(amountOutMin.toSignificant(6),\" \").concat(tokenOut,\" or the transaction will revert.\"):\"Input is estimated. You will sell at most \".concat(amountInMax.toSignificant(6),\" \").concat(tokenIn,\" or the transaction will revert.\"):null})]});return/*#__PURE__*/_jsxs(Card,{title:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"img\",{src:\"https://ipfs.io/ipfs/QmXttGpZrECX5qCyXbBQiqgQNytVGeZW5Anewvh2jc4psg\",width:\"40\",alt:\"uniswapLogo\"}),/*#__PURE__*/_jsx(Typography,{children:\"Uniswapper\"})]}),extra:/*#__PURE__*/_jsx(Button,{type:\"text\",onClick:function onClick(){setSettingsVisible(true);},children:/*#__PURE__*/_jsx(SettingOutlined,{})}),children:[/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsxs(Card,{size:\"small\",type:\"inner\",title:\"From\".concat(exact===\"out\"&&tokenIn&&tokenOut?\" (estimate)\":\"\"),extra:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoIn,alt:tokenIn,width:\"30\"}),/*#__PURE__*/_jsx(Button,{type:\"link\",onClick:function onClick(){setAmountOut();setAmountIn(ethers.utils.formatUnits(balanceIn,tokens[tokenIn].decimals));setAmountOutMin();setAmountInMax();setExact(\"in\");},children:formattedBalanceIn})]}),style:{width:400,textAlign:\"left\"},children:[/*#__PURE__*/_jsx(InputNumber,{style:{width:\"160px\"},min:0,size:\"large\",value:amountIn,onChange:function onChange(e){setAmountOut();setTrades();setAmountIn(e);setExact(\"in\");}}),/*#__PURE__*/_jsx(Select,{showSearch:true,value:tokenIn,style:{width:\"120px\"},size:\"large\",bordered:false,defaultValue:defaultToken,onChange:function onChange(value){console.log(value);if(value===tokenOut){console.log(\"switch!\",tokenIn);setTokenOut(tokenIn);setAmountOut(amountIn);setBalanceOut(balanceIn);}setTokenIn(value);setTrades();setAmountIn();setExact(\"out\");setBalanceIn();},filterOption:function filterOption(input,option){return option.children.toLowerCase().indexOf(input.toLowerCase())>=0;},optionFilterProp:\"children\",children:tokenList.map(function(token){return/*#__PURE__*/_jsx(Option,{value:token.symbol,children:token.symbol},token.symbol);})})]})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsx(Tooltip,{title:route.join(\"->\"),children:/*#__PURE__*/_jsx(\"span\",{children:\"\\u2193\"})})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsxs(Card,{size:\"small\",type:\"inner\",title:\"To\".concat(exact===\"in\"&&tokenIn&&tokenOut?\" (estimate)\":\"\"),extra:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"img\",{src:logoOut,width:\"30\",alt:tokenOut}),/*#__PURE__*/_jsx(Button,{type:\"text\",children:formattedBalanceOut})]}),style:{width:400,textAlign:\"left\"},children:[/*#__PURE__*/_jsx(InputNumber,{style:{width:\"160px\"},size:\"large\",min:0,value:amountOut,onChange:function onChange(e){setAmountOut(e);setAmountIn();setTrades();setExact(\"out\");}}),/*#__PURE__*/_jsx(Select,{showSearch:true,value:tokenOut,style:{width:\"120px\"},size:\"large\",bordered:false,onChange:function onChange(value){console.log(value,tokenIn,tokenOut);if(value===tokenIn){console.log(\"switch!\",tokenOut);setTokenIn(tokenOut);setAmountIn(amountOut);setBalanceIn(balanceOut);}setTokenOut(value);setExact(\"in\");setAmountOut();setTrades();setBalanceOut();},filterOption:function filterOption(input,option){return option.children.toLowerCase().indexOf(input.toLowerCase())>=0;},optionFilterProp:\"children\",children:tokenList.map(function(token){return/*#__PURE__*/_jsx(Option,{value:token.symbol,children:token.symbol},token.symbol);})})]})}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:priceDescription?priceWidget:null}),/*#__PURE__*/_jsx(Row,{justify:\"center\",align:\"middle\",children:/*#__PURE__*/_jsxs(Space,{children:[inputIsToken?/*#__PURE__*/_jsx(Button,{size:\"large\",loading:approving,disabled:!insufficientAllowance,onClick:approveRouter,children:!insufficientAllowance&&amountIn&&amountOut?\"Approved\":\"Approve\"}):null,/*#__PURE__*/_jsx(Button,{size:\"large\",loading:swapping,disabled:insufficientAllowance||insufficientBalance||!amountIn||!amountOut,onClick:showSwapModal,children:insufficientBalance?\"Insufficient balance\":\"Swap!\"}),swapModal]})})]}),/*#__PURE__*/_jsx(Drawer,{visible:settingsVisible,onClose:function onClose(){setSettingsVisible(false);},width:500,children:/*#__PURE__*/_jsxs(Descriptions,{title:\"Details\",column:1,style:{textAlign:\"left\"},children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:\"blockNumber\",children:blockNumber}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"routerAllowance\",children:/*#__PURE__*/_jsxs(Space,{children:[routerAllowance?ethers.utils.formatUnits(routerAllowance,tokens[tokenIn].decimals):null,routerAllowance>0?/*#__PURE__*/_jsx(Button,{onClick:removeRouterAllowance,children:\"Remove Allowance\"}):null]})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"route\",children:route.join(\"->\")}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"exact\",children:exact}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"bestPrice\",children:trades?trades.length>0?trades[0].executionPrice.toSignificant(6):null:null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"nextMidPrice\",children:trades?trades.length>0?trades[0].nextMidPrice.toSignificant(6):null:null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"priceImpact\",children:trades?trades.length>0?trades[0].priceImpact.toSignificant(6):null:null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"slippageTolerance\",children:/*#__PURE__*/_jsx(InputNumber,{defaultValue:defaultSlippage,min:0,max:100,precision:2,formatter:function formatter(value){return\"\".concat(value,\"%\");},parser:function parser(value){return value.replace(\"%\",\"\");},onChange:function onChange(value){console.log(value);var slippagePercent=new Percent(Math.round(value*100).toString(),\"10000\");setSlippageTolerance(slippagePercent);}})}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"amountInMax\",children:amountInMax?amountInMax.toExact():null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"amountOutMin\",children:amountOutMin?amountOutMin.toExact():null}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"timeLimitInSeconds\",children:/*#__PURE__*/_jsx(InputNumber,{min:0,max:3600,defaultValue:defaultTimeLimit,onChange:function onChange(value){console.log(value);setTimeLimit(value);}})})]})})]});}export default Swap;","map":{"version":3,"sources":["/Users/untitled/challenge-4-single-pool-dex/packages/react-app/src/components/Swap.jsx"],"names":["RetweetOutlined","SettingOutlined","ChainId","Fetcher","Percent","Token","TokenAmount","Trade","WETH","abi","IUniswapV2Router02ABI","Button","Card","Descriptions","Divider","Drawer","InputNumber","Modal","notification","Row","Select","Space","Tooltip","Typography","useBlockNumber","usePoller","ethers","React","useEffect","useState","useDebounce","Option","Text","ROUTER_ADDRESS","ZERO_ADDRESS","erc20Abi","makeCall","callName","contract","args","metadata","result","console","log","undefined","defaultToken","defaultTokenOut","defaultSlippage","defaultTimeLimit","tokenListToObject","array","reduce","obj","item","symbol","chainId","address","decimals","name","Swap","selectedProvider","tokenListURI","tokenIn","setTokenIn","tokenOut","setTokenOut","exact","setExact","amountIn","setAmountIn","amountInMax","setAmountInMax","amountOut","setAmountOut","amountOutMin","setAmountOutMin","trades","setTrades","routerAllowance","setRouterAllowance","balanceIn","setBalanceIn","balanceOut","setBalanceOut","Math","round","toString","slippageTolerance","setSlippageTolerance","timeLimit","setTimeLimit","swapping","setSwapping","approving","setApproving","settingsVisible","setSettingsVisible","swapModalVisible","setSwapModalVisible","tokenList","setTokenList","tokens","setTokens","invertPrice","setInvertPrice","blockNumber","signer","getSigner","routerContract","Contract","_tokenListUri","debouncedAmountIn","debouncedAmountOut","activeChainId","process","env","REACT_APP_NETWORK","KOVAN","MAINNET","getTokenList","fetch","tokenListResponse","json","tokenListJson","filteredTokens","filter","t","ethToken","logoURI","_tokenList","_tokens","getTrades","pairs","arr","map","v","i","slice","w","flat","baseTokens","includes","el","listOfPairwiseTokens","getPairs","list","listOfPromises","fetchPairData","Promise","all","p","catch","listOfPairs","bestTrade","bestTradeExactIn","utils","parseUnits","maxNumResults","maxHops","outputAmount","toSignificant","bestTradeExactOut","inputAmount","minimumAmountOut","maximumAmountIn","getBalance","_token","_account","_contract","newBalance","getAccountInfo","listAccounts","accountList","tempContractIn","newBalanceIn","allowance","tempContractOut","newBalanceOut","route","length","path","updateRouterAllowance","newAllowance","tempContract","open","message","description","approveRouter","approvalAmount","hexlify","raw","approval","removeRouterAllowance","removal","executeSwap","deadline","floor","Date","now","_amountIn","_amountOutMin","BigNumber","from","call","value","_amountOut","_amountInMax","hash","showSwapModal","handleSwapModalOk","handleSwapModalCancel","insufficientBalance","parseFloat","formatUnits","inputIsToken","insufficientAllowance","formattedBalanceIn","toPrecision","formattedBalanceOut","metaIn","metaOut","cleanIpfsURI","uri","replace","e","logoIn","logoOut","rawPrice","executionPrice","price","priceDescription","invert","priceWidget","swapModal","width","textAlign","input","option","children","toLowerCase","indexOf","token","join","nextMidPrice","priceImpact","slippagePercent","toExact"],"mappings":"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","sourcesContent":["import { RetweetOutlined, SettingOutlined } from \"@ant-design/icons\";\nimport { ChainId, Fetcher, Percent, Token, TokenAmount, Trade, WETH } from \"@uniswap/sdk\";\nimport { abi as IUniswapV2Router02ABI } from \"@uniswap/v2-periphery/build/IUniswapV2Router02.json\";\nimport {\n  Button,\n  Card,\n  Descriptions,\n  Divider,\n  Drawer,\n  InputNumber,\n  Modal,\n  notification,\n  Row,\n  Select,\n  Space,\n  Tooltip,\n  Typography,\n} from \"antd\";\nimport { useBlockNumber, usePoller } from \"eth-hooks\";\nimport { ethers } from \"ethers\";\nimport React, { useEffect, useState } from \"react\";\nimport { useDebounce } from \"../hooks\";\n\nconst { Option } = Select;\nconst { Text } = Typography;\n\nexport const ROUTER_ADDRESS = \"0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D\";\n\nexport const ZERO_ADDRESS = \"0x0000000000000000000000000000000000000000\";\n\nconst erc20Abi = [\n  \"function balanceOf(address owner) view returns (uint256)\",\n  \"function approve(address _spender, uint256 _value) public returns (bool success)\",\n  \"function allowance(address _owner, address _spender) public view returns (uint256 remaining)\",\n];\n\nconst makeCall = async (callName, contract, args, metadata = {}) => {\n  if (contract[callName]) {\n    let result;\n    if (args) {\n      result = await contract[callName](...args, metadata);\n    } else {\n      result = await contract[callName]();\n    }\n    return result;\n  }\n  console.log(\"no call of that name!\");\n  return undefined;\n};\n\nconst defaultToken = \"ETH\";\nconst defaultTokenOut = \"DAI\";\nconst defaultSlippage = \"0.5\";\nconst defaultTimeLimit = 60 * 10;\n\nconst tokenListToObject = array =>\n  array.reduce((obj, item) => {\n    obj[item.symbol] = new Token(item.chainId, item.address, item.decimals, item.symbol, item.name);\n    return obj;\n  }, {});\n\nfunction Swap({ selectedProvider, tokenListURI }) {\n  const [tokenIn, setTokenIn] = useState(defaultToken);\n  const [tokenOut, setTokenOut] = useState(defaultTokenOut);\n  const [exact, setExact] = useState();\n  const [amountIn, setAmountIn] = useState();\n  const [amountInMax, setAmountInMax] = useState();\n  const [amountOut, setAmountOut] = useState();\n  const [amountOutMin, setAmountOutMin] = useState();\n  const [trades, setTrades] = useState();\n  const [routerAllowance, setRouterAllowance] = useState();\n  const [balanceIn, setBalanceIn] = useState();\n  const [balanceOut, setBalanceOut] = useState();\n  const [slippageTolerance, setSlippageTolerance] = useState(\n    new Percent(Math.round(defaultSlippage * 100).toString(), \"10000\"),\n  );\n  const [timeLimit, setTimeLimit] = useState(defaultTimeLimit);\n  const [swapping, setSwapping] = useState(false);\n  const [approving, setApproving] = useState(false);\n  const [settingsVisible, setSettingsVisible] = useState(false);\n  const [swapModalVisible, setSwapModalVisible] = useState(false);\n\n  const [tokenList, setTokenList] = useState([]);\n  const [tokens, setTokens] = useState();\n  const [invertPrice, setInvertPrice] = useState(false);\n\n  const blockNumber = useBlockNumber(selectedProvider, 3000);\n\n  const signer = selectedProvider.getSigner();\n  const routerContract = new ethers.Contract(ROUTER_ADDRESS, IUniswapV2Router02ABI, signer);\n\n  const _tokenListUri = tokenListURI || \"https://gateway.ipfs.io/ipns/tokens.uniswap.org\";\n\n  const debouncedAmountIn = useDebounce(amountIn, 500);\n  const debouncedAmountOut = useDebounce(amountOut, 500);\n\n  const activeChainId = process.env.REACT_APP_NETWORK === \"kovan\" ? ChainId.KOVAN : ChainId.MAINNET;\n\n  useEffect(() => {\n    const getTokenList = async () => {\n      console.log(_tokenListUri);\n      try {\n        const tokenListResponse = await fetch(_tokenListUri);\n        const tokenListJson = await tokenListResponse.json();\n        const filteredTokens = tokenListJson.tokens.filter(function (t) {\n          return t.chainId === activeChainId;\n        });\n        const ethToken = WETH[activeChainId];\n        ethToken.name = \"Ethereum\";\n        ethToken.symbol = \"ETH\";\n        ethToken.logoURI =\n          \"https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/assets/0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2/logo.png\";\n        const _tokenList = [ethToken, ...filteredTokens];\n        setTokenList(_tokenList);\n        const _tokens = tokenListToObject(_tokenList);\n        setTokens(_tokens);\n      } catch (e) {\n        console.log(e);\n      }\n    };\n    getTokenList();\n  }, [tokenListURI, _tokenListUri, activeChainId]);\n\n  const getTrades = async () => {\n    if (tokenIn && tokenOut && (amountIn || amountOut)) {\n      const pairs = arr => arr.map((v, i) => arr.slice(i + 1).map(w => [v, w])).flat();\n\n      const baseTokens = tokenList\n        .filter(function (t) {\n          return [\"DAI\", \"USDC\", \"USDT\", \"COMP\", \"ETH\", \"MKR\", \"LINK\", tokenIn, tokenOut].includes(t.symbol);\n        })\n        .map(el => {\n          return new Token(el.chainId, el.address, el.decimals, el.symbol, el.name);\n        });\n\n      const listOfPairwiseTokens = pairs(baseTokens);\n\n      const getPairs = async list => {\n        const listOfPromises = list.map(item => Fetcher.fetchPairData(item[0], item[1], selectedProvider));\n        return Promise.all(listOfPromises.map(p => p.catch(() => undefined)));\n      };\n\n      const listOfPairs = await getPairs(listOfPairwiseTokens);\n\n      let bestTrade;\n\n      if (exact === \"in\") {\n        setAmountInMax();\n        bestTrade = Trade.bestTradeExactIn(\n          listOfPairs.filter(item => item),\n          new TokenAmount(tokens[tokenIn], ethers.utils.parseUnits(amountIn.toString(), tokens[tokenIn].decimals)),\n          tokens[tokenOut],\n          { maxNumResults: 3, maxHops: 1 },\n        );\n        if (bestTrade[0]) {\n          setAmountOut(bestTrade[0].outputAmount.toSignificant(6));\n        } else {\n          setAmountOut();\n        }\n      } else if (exact === \"out\") {\n        setAmountOutMin();\n        bestTrade = Trade.bestTradeExactOut(\n          listOfPairs.filter(item => item),\n          tokens[tokenIn],\n          new TokenAmount(tokens[tokenOut], ethers.utils.parseUnits(amountOut.toString(), tokens[tokenOut].decimals)),\n          { maxNumResults: 3, maxHops: 1 },\n        );\n        if (bestTrade[0]) {\n          setAmountIn(bestTrade[0].inputAmount.toSignificant(6));\n        } else {\n          setAmountIn();\n        }\n      }\n\n      setTrades(bestTrade);\n\n      console.log(bestTrade);\n    }\n  };\n\n  useEffect(() => {\n    getTrades();\n    // eslint-disable-next-line\n  }, [tokenIn, tokenOut, debouncedAmountIn, debouncedAmountOut, slippageTolerance, selectedProvider]);\n\n  useEffect(() => {\n    if (trades && trades[0]) {\n      if (exact === \"in\") {\n        setAmountOutMin(trades[0].minimumAmountOut(slippageTolerance));\n      } else if (exact === \"out\") {\n        setAmountInMax(trades[0].maximumAmountIn(slippageTolerance));\n      }\n    }\n  }, [slippageTolerance, amountIn, amountOut, trades, exact]);\n\n  const getBalance = async (_token, _account, _contract) => {\n    let newBalance;\n    if (_token === \"ETH\") {\n      newBalance = await selectedProvider.getBalance(_account);\n    } else {\n      newBalance = await makeCall(\"balanceOf\", _contract, [_account]);\n    }\n    return newBalance;\n  };\n\n  const getAccountInfo = async () => {\n    if (tokens) {\n      const accountList = await selectedProvider.listAccounts();\n\n      if (tokenIn) {\n        const tempContractIn = new ethers.Contract(tokens[tokenIn].address, erc20Abi, selectedProvider);\n        const newBalanceIn = await getBalance(tokenIn, accountList[0], tempContractIn);\n        setBalanceIn(newBalanceIn);\n\n        let allowance;\n\n        if (tokenIn === \"ETH\") {\n          setRouterAllowance();\n        } else {\n          allowance = await makeCall(\"allowance\", tempContractIn, [accountList[0], ROUTER_ADDRESS]);\n          setRouterAllowance(allowance);\n        }\n      }\n\n      if (tokenOut) {\n        const tempContractOut = new ethers.Contract(tokens[tokenOut].address, erc20Abi, selectedProvider);\n        const newBalanceOut = await getBalance(tokenOut, accountList[0], tempContractOut);\n        setBalanceOut(newBalanceOut);\n      }\n    }\n  };\n\n  usePoller(getAccountInfo, 6000);\n\n  const route = trades\n    ? trades.length > 0\n      ? trades[0].route.path.map(function (item) {\n          return item.symbol;\n        })\n      : []\n    : [];\n\n  const updateRouterAllowance = async newAllowance => {\n    setApproving(true);\n    try {\n      const tempContract = new ethers.Contract(tokens[tokenIn].address, erc20Abi, signer);\n      const result = await makeCall(\"approve\", tempContract, [ROUTER_ADDRESS, newAllowance]);\n      console.log(result);\n      setApproving(false);\n      return true;\n    } catch (e) {\n      notification.open({\n        message: \"Approval unsuccessful\",\n        description: `Error: ${e.message}`,\n      });\n    }\n  };\n\n  const approveRouter = async () => {\n    const approvalAmount =\n      exact === \"in\"\n        ? ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(), tokens[tokenIn].decimals))\n        : amountInMax.raw.toString();\n    console.log(approvalAmount);\n    const approval = updateRouterAllowance(approvalAmount);\n    if (approval) {\n      notification.open({\n        message: \"Token transfer approved\",\n        description: `You can now swap up to ${amountIn} ${tokenIn}`,\n      });\n    }\n  };\n\n  const removeRouterAllowance = async () => {\n    const approvalAmount = ethers.utils.hexlify(0);\n    console.log(approvalAmount);\n    const removal = updateRouterAllowance(approvalAmount);\n    if (removal) {\n      notification.open({\n        message: \"Token approval removed\",\n        description: `The router is no longer approved for ${tokenIn}`,\n      });\n    }\n  };\n\n  const executeSwap = async () => {\n    setSwapping(true);\n    try {\n      let args;\n      const metadata = {};\n\n      let call;\n      const deadline = Math.floor(Date.now() / 1000) + timeLimit;\n      const path = trades[0].route.path.map(function (item) {\n        return item.address;\n      });\n      console.log(path);\n      const accountList = await selectedProvider.listAccounts();\n      const address = accountList[0];\n\n      if (exact === \"in\") {\n        const _amountIn = ethers.utils.hexlify(ethers.utils.parseUnits(amountIn.toString(), tokens[tokenIn].decimals));\n        const _amountOutMin = ethers.utils.hexlify(ethers.BigNumber.from(amountOutMin.raw.toString()));\n        if (tokenIn === \"ETH\") {\n          call = \"swapExactETHForTokens\";\n          args = [_amountOutMin, path, address, deadline];\n          metadata.value = _amountIn;\n        } else {\n          call = tokenOut === \"ETH\" ? \"swapExactTokensForETH\" : \"swapExactTokensForTokens\";\n          args = [_amountIn, _amountOutMin, path, address, deadline];\n        }\n      } else if (exact === \"out\") {\n        const _amountOut = ethers.utils.hexlify(\n          ethers.utils.parseUnits(amountOut.toString(), tokens[tokenOut].decimals),\n        );\n        const _amountInMax = ethers.utils.hexlify(ethers.BigNumber.from(amountInMax.raw.toString()));\n        if (tokenIn === \"ETH\") {\n          call = \"swapETHForExactTokens\";\n          args = [_amountOut, path, address, deadline];\n          metadata.value = _amountInMax;\n        } else {\n          call = tokenOut === \"ETH\" ? \"swapTokensForExactETH\" : \"swapTokensForExactTokens\";\n          args = [_amountOut, _amountInMax, path, address, deadline];\n        }\n      }\n      console.log(call, args, metadata);\n      const result = await makeCall(call, routerContract, args, metadata);\n      console.log(result);\n      notification.open({\n        message: \"Swap complete 🦄\",\n        description: (\n          <>\n            <Text>{`Swapped ${tokenIn} for ${tokenOut}, transaction: `}</Text>\n            <Text copyable>{result.hash}</Text>\n          </>\n        ),\n      });\n      setSwapping(false);\n    } catch (e) {\n      console.log(e);\n      setSwapping(false);\n      notification.open({\n        message: \"Swap unsuccessful\",\n        description: `Error: ${e.message}`,\n      });\n    }\n  };\n\n  const showSwapModal = () => {\n    setSwapModalVisible(true);\n  };\n\n  const handleSwapModalOk = () => {\n    setSwapModalVisible(false);\n    executeSwap();\n  };\n\n  const handleSwapModalCancel = () => {\n    setSwapModalVisible(false);\n  };\n\n  const insufficientBalance = balanceIn\n    ? parseFloat(ethers.utils.formatUnits(balanceIn, tokens[tokenIn].decimals)) < amountIn\n    : null;\n  const inputIsToken = tokenIn !== \"ETH\";\n  const insufficientAllowance = !inputIsToken\n    ? false\n    : routerAllowance\n    ? parseFloat(ethers.utils.formatUnits(routerAllowance, tokens[tokenIn].decimals)) < amountIn\n    : null;\n  const formattedBalanceIn = balanceIn\n    ? parseFloat(ethers.utils.formatUnits(balanceIn, tokens[tokenIn].decimals)).toPrecision(6)\n    : null;\n  const formattedBalanceOut = balanceOut\n    ? parseFloat(ethers.utils.formatUnits(balanceOut, tokens[tokenOut].decimals)).toPrecision(6)\n    : null;\n\n  const metaIn =\n    tokens && tokenList && tokenIn\n      ? tokenList.filter(function (t) {\n          return t.address === tokens[tokenIn].address;\n        })[0]\n      : null;\n  const metaOut =\n    tokens && tokenList && tokenOut\n      ? tokenList.filter(function (t) {\n          return t.address === tokens[tokenOut].address;\n        })[0]\n      : null;\n\n  const cleanIpfsURI = uri => {\n    try {\n      return uri.replace(\"ipfs://\", \"https://ipfs.io/ipfs/\");\n    } catch (e) {\n      console.log(e, uri);\n      return uri;\n    }\n  };\n\n  const logoIn = metaIn ? cleanIpfsURI(metaIn.logoURI) : null;\n  const logoOut = metaOut ? cleanIpfsURI(metaOut.logoURI) : null;\n\n  const rawPrice = trades && trades[0] ? trades[0].executionPrice : null;\n  const price = rawPrice ? rawPrice.toSignificant(7) : null;\n  const priceDescription = rawPrice\n    ? invertPrice\n      ? `${rawPrice.invert().toSignificant(7)} ${tokenIn} per ${tokenOut}`\n      : `${price} ${tokenOut} per ${tokenIn}`\n    : null;\n\n  const priceWidget = (\n    <Space>\n      <Text type=\"secondary\">{priceDescription}</Text>\n      <Button\n        type=\"text\"\n        onClick={() => {\n          setInvertPrice(!invertPrice);\n        }}\n      >\n        <RetweetOutlined />\n      </Button>\n    </Space>\n  );\n\n  const swapModal = (\n    <Modal title=\"Confirm swap\" visible={swapModalVisible} onOk={handleSwapModalOk} onCancel={handleSwapModalCancel}>\n      <Row>\n        <Space>\n          <img src={logoIn} alt={tokenIn} width=\"30\" />\n          {amountIn}\n          {tokenIn}\n        </Space>\n      </Row>\n      <Row justify=\"center\" align=\"middle\" style={{ width: 30 }}>\n        <span>↓</span>\n      </Row>\n      <Row>\n        <Space>\n          <img src={logoOut} alt={tokenOut} width=\"30\" />\n          {amountOut}\n          {tokenOut}\n        </Space>\n      </Row>\n      <Divider />\n      <Row>{priceWidget}</Row>\n      <Row>\n        {trades && ((amountOutMin && exact === \"in\") || (amountInMax && exact === \"out\"))\n          ? exact === \"in\"\n            ? `Output is estimated. You will receive at least ${amountOutMin.toSignificant(\n                6,\n              )} ${tokenOut} or the transaction will revert.`\n            : `Input is estimated. You will sell at most ${amountInMax.toSignificant(\n                6,\n              )} ${tokenIn} or the transaction will revert.`\n          : null}\n      </Row>\n    </Modal>\n  );\n\n  return (\n    <Card\n      title={\n        <Space>\n          <img src=\"https://ipfs.io/ipfs/QmXttGpZrECX5qCyXbBQiqgQNytVGeZW5Anewvh2jc4psg\" width=\"40\" alt=\"uniswapLogo\" />\n          <Typography>Uniswapper</Typography>\n        </Space>\n      }\n      extra={\n        <Button\n          type=\"text\"\n          onClick={() => {\n            setSettingsVisible(true);\n          }}\n        >\n          <SettingOutlined />\n        </Button>\n      }\n    >\n      <Space direction=\"vertical\">\n        <Row justify=\"center\" align=\"middle\">\n          <Card\n            size=\"small\"\n            type=\"inner\"\n            title={`From${exact === \"out\" && tokenIn && tokenOut ? \" (estimate)\" : \"\"}`}\n            extra={\n              <>\n                <img src={logoIn} alt={tokenIn} width=\"30\" />\n                <Button\n                  type=\"link\"\n                  onClick={() => {\n                    setAmountOut();\n                    setAmountIn(ethers.utils.formatUnits(balanceIn, tokens[tokenIn].decimals));\n                    setAmountOutMin();\n                    setAmountInMax();\n                    setExact(\"in\");\n                  }}\n                >\n                  {formattedBalanceIn}\n                </Button>\n              </>\n            }\n            style={{ width: 400, textAlign: \"left\" }}\n          >\n            <InputNumber\n              style={{ width: \"160px\" }}\n              min={0}\n              size=\"large\"\n              value={amountIn}\n              onChange={e => {\n                setAmountOut();\n                setTrades();\n                setAmountIn(e);\n                setExact(\"in\");\n              }}\n            />\n            <Select\n              showSearch\n              value={tokenIn}\n              style={{ width: \"120px\" }}\n              size=\"large\"\n              bordered={false}\n              defaultValue={defaultToken}\n              onChange={value => {\n                console.log(value);\n                if (value === tokenOut) {\n                  console.log(\"switch!\", tokenIn);\n                  setTokenOut(tokenIn);\n                  setAmountOut(amountIn);\n                  setBalanceOut(balanceIn);\n                }\n                setTokenIn(value);\n                setTrades();\n                setAmountIn();\n                setExact(\"out\");\n                setBalanceIn();\n              }}\n              filterOption={(input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0}\n              optionFilterProp=\"children\"\n            >\n              {tokenList.map(token => (\n                <Option key={token.symbol} value={token.symbol}>\n                  {token.symbol}\n                </Option>\n              ))}\n            </Select>\n          </Card>\n        </Row>\n        <Row justify=\"center\" align=\"middle\">\n          <Tooltip title={route.join(\"->\")}>\n            <span>↓</span>\n          </Tooltip>\n        </Row>\n        <Row justify=\"center\" align=\"middle\">\n          <Card\n            size=\"small\"\n            type=\"inner\"\n            title={`To${exact === \"in\" && tokenIn && tokenOut ? \" (estimate)\" : \"\"}`}\n            extra={\n              <>\n                <img src={logoOut} width=\"30\" alt={tokenOut} />\n                <Button type=\"text\">{formattedBalanceOut}</Button>\n              </>\n            }\n            style={{ width: 400, textAlign: \"left\" }}\n          >\n            <InputNumber\n              style={{ width: \"160px\" }}\n              size=\"large\"\n              min={0}\n              value={amountOut}\n              onChange={e => {\n                setAmountOut(e);\n                setAmountIn();\n                setTrades();\n                setExact(\"out\");\n              }}\n            />\n            <Select\n              showSearch\n              value={tokenOut}\n              style={{ width: \"120px\" }}\n              size=\"large\"\n              bordered={false}\n              onChange={value => {\n                console.log(value, tokenIn, tokenOut);\n                if (value === tokenIn) {\n                  console.log(\"switch!\", tokenOut);\n                  setTokenIn(tokenOut);\n                  setAmountIn(amountOut);\n                  setBalanceIn(balanceOut);\n                }\n                setTokenOut(value);\n                setExact(\"in\");\n                setAmountOut();\n                setTrades();\n                setBalanceOut();\n              }}\n              filterOption={(input, option) => option.children.toLowerCase().indexOf(input.toLowerCase()) >= 0}\n              optionFilterProp=\"children\"\n            >\n              {tokenList.map(token => (\n                <Option key={token.symbol} value={token.symbol}>\n                  {token.symbol}\n                </Option>\n              ))}\n            </Select>\n          </Card>\n        </Row>\n        <Row justify=\"center\" align=\"middle\">\n          {priceDescription ? priceWidget : null}\n        </Row>\n        <Row justify=\"center\" align=\"middle\">\n          <Space>\n            {inputIsToken ? (\n              <Button size=\"large\" loading={approving} disabled={!insufficientAllowance} onClick={approveRouter}>\n                {!insufficientAllowance && amountIn && amountOut ? \"Approved\" : \"Approve\"}\n              </Button>\n            ) : null}\n            <Button\n              size=\"large\"\n              loading={swapping}\n              disabled={insufficientAllowance || insufficientBalance || !amountIn || !amountOut}\n              onClick={showSwapModal}\n            >\n              {insufficientBalance ? \"Insufficient balance\" : \"Swap!\"}\n            </Button>\n            {swapModal}\n          </Space>\n        </Row>\n      </Space>\n      <Drawer\n        visible={settingsVisible}\n        onClose={() => {\n          setSettingsVisible(false);\n        }}\n        width={500}\n      >\n        <Descriptions title=\"Details\" column={1} style={{ textAlign: \"left\" }}>\n          <Descriptions.Item label=\"blockNumber\">{blockNumber}</Descriptions.Item>\n          <Descriptions.Item label=\"routerAllowance\">\n            <Space>\n              {routerAllowance ? ethers.utils.formatUnits(routerAllowance, tokens[tokenIn].decimals) : null}\n              {routerAllowance > 0 ? <Button onClick={removeRouterAllowance}>Remove Allowance</Button> : null}\n            </Space>\n          </Descriptions.Item>\n          <Descriptions.Item label=\"route\">{route.join(\"->\")}</Descriptions.Item>\n          <Descriptions.Item label=\"exact\">{exact}</Descriptions.Item>\n          <Descriptions.Item label=\"bestPrice\">\n            {trades ? (trades.length > 0 ? trades[0].executionPrice.toSignificant(6) : null) : null}\n          </Descriptions.Item>\n          <Descriptions.Item label=\"nextMidPrice\">\n            {trades ? (trades.length > 0 ? trades[0].nextMidPrice.toSignificant(6) : null) : null}\n          </Descriptions.Item>\n          <Descriptions.Item label=\"priceImpact\">\n            {trades ? (trades.length > 0 ? trades[0].priceImpact.toSignificant(6) : null) : null}\n          </Descriptions.Item>\n          <Descriptions.Item label=\"slippageTolerance\">\n            <InputNumber\n              defaultValue={defaultSlippage}\n              min={0}\n              max={100}\n              precision={2}\n              formatter={value => `${value}%`}\n              parser={value => value.replace(\"%\", \"\")}\n              onChange={value => {\n                console.log(value);\n\n                const slippagePercent = new Percent(Math.round(value * 100).toString(), \"10000\");\n                setSlippageTolerance(slippagePercent);\n              }}\n            />\n          </Descriptions.Item>\n          <Descriptions.Item label=\"amountInMax\">{amountInMax ? amountInMax.toExact() : null}</Descriptions.Item>\n          <Descriptions.Item label=\"amountOutMin\">{amountOutMin ? amountOutMin.toExact() : null}</Descriptions.Item>\n          <Descriptions.Item label=\"timeLimitInSeconds\">\n            <InputNumber\n              min={0}\n              max={3600}\n              defaultValue={defaultTimeLimit}\n              onChange={value => {\n                console.log(value);\n                setTimeLimit(value);\n              }}\n            />\n          </Descriptions.Item>\n        </Descriptions>\n      </Drawer>\n    </Card>\n  );\n}\n\nexport default Swap;\n"]},"metadata":{},"sourceType":"module"}